{"version":3,"sources":["components/MultiSelect.jsx","img/location-icon-atlas.png","utils.js","components/showcases/util_quant.js","components/Card.jsx","components/DataInput.jsx","components/MapboxBaseLayers.jsx","components/RBAlert.jsx","components/ColourPicker.jsx","components/Modal.jsx","components/showcases/factory.js","components/showcases/GenericPlotly.jsx","components/showcases/Widgets.jsx","components/showcases/plots.jsx","components/boxplot/Boxplot.jsx","components/settings/LayerSettings.jsx","components/decksidebar/DeckSidebar.jsx","components/showcases/HexbinSeries.jsx","components/decksidebar/HexPlot.jsx","components/decksidebar/DeckSidebarContainer.jsx","history.js","components/Tooltip.jsx","Welcome.js","components/Header.jsx","About.js","components/DynamicImport.jsx","App.js","registerServiceWorker.js","index.js","components/customlayers/BarLayer.js","components/settings/settingsUtils.js","icon-cluster-layer.js","JSUtils.js","components/showcases/SeriesPlot.jsx","components/File.jsx","components/URL.jsx","Constants.js","components/Variables.jsx","components/Table.jsx","components/UI.js","geojsonutils.js","components/TreeMap.jsx","components/AddVIS.jsx"],"names":["props","useState","value","setValue","onSelectCallback","values","filter","multiVarSelect","title","single","options","labelKey","valueKey","placeholder","maxDropdownHeight","type","TYPE","search","multi","onChange","Object","keys","length","Set","map","e","what","selected","fetchData","url","callback","fetch","then","response","text","endsWith","csv2geojson","err","data","json","JSON","parse","error","undefined","catch","console","xyObjectByProperty","property","noNulls","Map","forEach","feature","properties","isNumValue","get","set","sortedArray","Array","from","sort","ascending","key","x","y","generateDeckLayer","scaleThreshold","domain","range","name","renderTooltip","addOptionsToObject","opt","obj","iconObj","id","pickable","iconAtlas","atlas","iconMapping","mapping","sizeScale","getPosition","d","geometry","coordinates","wrapLongitude","onHover","IconClusterLayer","layerProps","getLayerProps","class","layerOptions","default","generateOptions","convertRange","oldValue","oldMax","oldMin","newMax","newMin","toFixed","getParamsFromSearch","qsResult","qs","replace","lat","Number","lng","latitude","isNaN","longitude","zoom","pit","bea","alt","getBbx","bounds","xmin","_sw","xmax","_ne","ymin","ymax","suggestDeckLayer","features","r","randomToNumber","sfType","RegExp","test","suggestUIforNumber","number","UI_LIST","Constants","humanize","str","frags","split","i","charAt","toUpperCase","slice","join","shortenName","n","isNumber","parseFloat","toString","isString","shortened","trim","extension","pop","substring","firstLastNCharacters","percentDiv","left","cb","dark","onClick","style","cursor","textAlign","position","float","width","color","margin","border","height","background","isURL","a","document","createElement","href","host","window","location","isMobile","check","innerWidth","navigator","userAgent","vendor","opera","substr","colorScale","v","alpha","colorName","isArray","index","indexOf","d3InterpolateFn","colorRangeNamesToInterpolate","interpolateOrRd","rgb","colorRangeNames","interpolateReds","interpolateYlGnBu","interpolateGreens","interpolateOranges","interpolateSinebow","colorRanges","yellowblue","greens","oranges","diverge","inverseDefault","getColorArray","searchNominatom","ATILOGO","stroke","strokeWidth","fill","fillRule","data-svg-origin","transform","zIndex","visibility","opacity","points","generateLegend","interpolate","jMax","jMin","legend","push","generateDomain","column","domainIsNumeric","Math","floor","b","getMax","arr","reduce","max","Infinity","getMin","OSMTILES","setGeojsonProps","geojson","geoColumn","result","assign","isObject","getFirstDateColumnName","DATE_REGEX","getMessage","array","getMainMessage","filtered","unfiltered","URL","PRD_URL","fetchQuant","fullURL","log","collection","map_code_point","f","msoa11cd","line","helpers","origin_msoacode","destination_msoacode","base","hs2","headerImage","image","body","loadCallback","overrides","BaseButton","button","require","partURL","React","isOpen","setOpen","urlCallback","toggleOpen","kind","KIND","secondary","size","SIZE","compact","s","onClose","File","contentCallback","match","flexGridColumnCount","flexGridColumnGap","flexGridRowGap","process","NO_CARDS","info","SPENSER","api","QUANT","itemProps","Card","apiURL","cards","display","alignItems","justifyContent","MapboxBaseLayers","state","bases","this","MultiSelect","setState","Component","ToastAlert","timeDuration","dismissTimeoutId","clearTimeout","nextProps","alert","time","Boolean","dismissTimeout","setTimeout","content","Alert","variant","ColorPicker","chosen","setChosen","colourCallback","className","each","backgroundColor","open","component","fontSize","eventNames","updateEvents","isBrowser","Plot","Plotly","PlotlyComponent","p","Promise","resolve","resizeHandler","handlers","syncWindowResize","bind","syncEventHandlers","attachUpdateEvents","getRef","handleUpdate","figureCallback","updatePlotly","shouldInvokeResizeHandler","figureCallbackFunction","shouldAttachUpdateEvents","unmounting","el","Error","react","layout","config","frames","onError","onInitialized","prevProps","numPrevFrames","numNextFrames","figureChanged","revisionDefined","revision","revisionChanged","onUpdate","onPurge","removeEventListener","removeUpdateEvents","purge","removeListener","updateEvent","on","_transitionData","_frames","invoke","useResizeHandler","Plots","resize","addEventListener","debug","gd","eventName","prop","handler","hasHandler","addEventHandler","removeEventHandler","getPlotlyEventName","toLowerCase","divId","ref","propTypes","PropTypes","func","defaultProps","createPlotlyComponent","xaxis","yaxis","displayModeBar","axes","visible","sColor","font","t","l","paper_bgcolor","plot_bgcolor","orientation","yearSlider","year","yearColumn","DateTime","fromISO","isValid","years","getPropertyValues","sublist","suggested","W","PLOT_W","COLOR_F","COLOR_M","plotByPropertyByDate","plot_data_multi","arrayOfYearAndProperty","GenericPlotly","showgrid","mode","showlegend","Date","marker","scaleSequential","TURQUOISE_RANGE","plotByProperty","data_by_prop","hasOwnProperty","popPyramidPlot","date","sex_of_casualty","mf","propertyCountByProperty","mf_array_male","mf_array_female","x0","Male","y0","Female","plotStyle","tickSize","tickFormat","fontWeight","format","items","notEmpty","random","timeCols","isStringDate","lineAttrs","marginLeft","marginTop","isNumeric","H","data_sorted","q1","quantile","median","q3","interQuantileRange","min","outliers","scale","item","idx","maxWidth","lineColor","x1","x2","y1","yMiddle","y2","Y","yHeight","fillColor","cx","cy","LayerSettings","layerName","columnNames","onLayerOptionsCallback","setOptions","setValues","useEffect","lp","step","newValues","checked","getUIForKey","DeckSidebar","radius","elevation","reset","barChartVariable","datasetName","nextState","loading","layerStyle","subsetBoundsChange","unfilteredData","toggleSubsetBoundsChange","onlocationChange","toggleHexPlot","withRadius","severity_data","propertyCount","columnDomain","columnData","isEmptyOrSpaces","columnPlot","resetState","urlOrName","RBAlert","_headerComponent","DataInput","Modal","showLegend","changes","has","clear","Boxplot","Tabs","defaultActiveKey","Tab","eventKey","_panel","AddVIS","newBarChartVar","SeriesPlot","VerticalBarSeries","onValueClick","datapoint","onDragSelected","datapoints","marginBottom","noYAxis","LAYERS","ls","Checkbox","Variables","mvs","onSubmit","preventDefault","bbox","boundingbox","num","lon","FormGroup","InputGroup","FormControl","target","Addon","Glyphicon","glyph","borderColor","HexHeatmap","hoveredNode","offset","bottom","onMouseLeave","animation","strokeLinejoin","colorRange","noXAxis","tickLabelAngle","marginRight","coordsAsXY","hex","setHex","o","h","HexPlot","createBrowserHistory","WIDTH","Tooltip","_listPropsAndValues","_handleWindowSizeChange","forceUpdate","topx","topy","hoveredObject","column1","column2","type_feature","cluster","severity_data_separate","severity_keys","source","severity_by_year","w","innerHeight","n_topy","n_left","top","point_count","tickformat","all","DATA","columns","defualtURL","gradient","Welcome","_resize","init","DECKGL_INIT","param","iKey","startsWith","layers","backgroundImage","RADIUS","ELEVATION","cellSize","mapStyle","initialViewState","lastViewPortChange","iconLimit","ICONLIMIT","tooltipColumns","geographyURL","REACT_APP_GEOGRAPHY_URL","geographyColumn","REACT_APP_GEOGRAPHY_COLUMN_NAME","REACT_APP_COLUMN_NAME","_generateLayer","_renderTooltip","_fetchAndUpdateState","_fitViewport","_initWithGeojson","_updateURL","_throttleUR","throttle","aURL","customError","geoErr","geography","cn","newStyle","BLANKSTYLE","columnNameOrIndex","coords","filterValues","filterCoords","nextValue","_","difference","flat","geomType","switchToIcon","lightSettings","LIGHT_SETTINGS","getColor","getValue","updateTriggers","getWeight","getPath","includes","object","getSourcePosition","getTargetPosition","getWidth","_newRange","getRadius","newLegend","getFillColor","getScale","getRotationAngle","alayer","tooltip","road_type","newData","bboxLonLat","center","centroid","fitBounds","padding","viewport","transitionDuration","transitionInterpolator","FlyToInterpolator","params","bearing","pitch","altitude","history","getBounds","box","getMap","onViewportChange","viewState","layer","DeckSidebarContainer","url_returned","geojson_returned","message","navs","to","withRouter","setDark","Navbar","inverse","collapseOnSelect","Header","Brand","Link","viewBox","version","xmlns","xlink","Toggle","Collapse","Nav","NavItem","pullRight","toggleTheme","aria-hidden","fill-rule","clip-rule","About","markdown","marked","dangerouslySetInnerHTML","__html","DynamicImport","load","children","engine","Styletron","DUI","App","BrowserRouter","basename","theme","DarkTheme","LightTheme","Switch","Route","exact","path","hostname","ReactDOM","render","getElementById","serviceWorker","ready","registration","unregister","BarLayer","vs","fs","modules","project32","picking","getAttributeManager","addInstanced","instancePositions","GL","DOUBLE","accessor","instanceRadius","defaultValue","instanceColors","UNSIGNED_BYTE","smoothRadius","normalized","instanceScale","instanceRotationAngle","instanceWidth","oldProps","changeFlags","extensionsChanged","gl","context","model","delete","_getModel","uniforms","setUniforms","draw","Model","getShaders","Geometry","drawMode","TRIANGLE_STRIP","vertexCount","attributes","positions","Float32Array","isInstanced","Layer","makeObject","def","extruded","hexObject","HexagonLayer","elevationScale","scatterObj","ScatterplotLayer","radiusScale","radiusMinPixels","radiusMaxPixels","geojsonObject","GeoJsonLayer","stroked","filled","lineWidthScale","lineWidthMinPixels","getLineWidth","getElevation","iconObject","sgridObject","ScreenGridLayer","cellSizePixels","gridObject","GridLayer","lineObject","LineLayer","arcObject","ArcLayer","pathObject","PathLayer","heatObject","HeatmapLayer","textObject","TextLayer","barvisObject","freeze","somethingChanged","rebuildIndex","dataChanged","Supercluster","maxZoom","z","getClusters","pickedObject","objects","getLeaves","cluster_id","IconLayer","getSubLayerProps","getIcon","getSize","CompositeLayer","constructor","String","isBoolean","exports","isDate","prototype","call","getTime","sanitizeFloat","sanitizeInt","parseInt","sanitizeString","string","sanitizeStringNonNull","sanitizeBool","bool","FlexibleXYPlot","makeWidthFlexible","XYPlot","hint","setHint","setX","setY","setX1","setY1","rect","setRect","setSelected","ReactSeries","limit","MarkSeries","noLimit","dataWithColor","onMouseDown","clientX","clientY","onMouseMove","newX","newY","abs","onMouseUp","onMouseOut","xType","duration","tickValues","onNearestX","innerX","isWithinRect","colorDomain","Uploader","progressAmount","handleDrop","acceptedFiles","rejectedFiles","file","reader","FileReader","onload","readAsText","startProgress","intervalId","setInterval","clearInterval","onCancel","onDrop","progressMessage","setUrl","onKeyPress","event","which","define","defineProperty","enumerable","lightsPosition","ambientRatio","diffuseRatio","specularRatio","lightsStrength","numberOfLights","setColumns","description","describeFeatureVariables","dataCols","syncColumns","concat","columnsArray","columnValues","DataTable","currentPage","setCurrentPage","numPages","rows","onPageChange","nextPage","UI","checks","steps","new_checks","ui_name","ui_returned","initialState","v_type","add","list","sub_data","list_copy","key2","k2","getFullYear","sizeProperty","fromFormat","fromHTTP","fromMillis","FlexibleTreemap","Treemap","TreeMap","setHoveredNode","treeProps","damping","stiffness","onLeafMouseOver","onLeafMouseOut","getLabel","VIS","generateVIS","vis","counts","HorizontalBarSeries","LineSeries","setColumn","setVis","setList","noAccordion","plot","j","Root","expanded"],"mappings":"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","file":"static/js/main.572eed9d.chunk.js","sourcesContent":["import React, { useState } from 'react';\nimport { Select, TYPE } from 'baseui/select';\n\nexport default (props) => {\n  const [value, setValue] = useState([]);\n  const { onSelectCallback, values, filter, multiVarSelect,\n    title, single } = props;  \n  return (\n    <Select\n      options={values}\n      labelKey=\"id\"\n      valueKey=\"value\"\n      placeholder={title || \"Choose\"}\n      maxDropdownHeight=\"300px\"\n      type={TYPE.search}\n      multi={!single}\n      onChange={({ value }) => {\n        setValue(value);\n        if (multiVarSelect) {\n          Object.keys(value).length === 0 ? delete multiVarSelect[filter] :\n            // everytime it gives back the chosen list of objects\n            multiVarSelect[filter] = new Set(value.map(e => e.value));\n          typeof onSelectCallback === 'function' &&\n            onSelectCallback(Object.keys(multiVarSelect).length === 0 ?\n              { what: '' } : { what: 'multi', selected: multiVarSelect });\n        } else {\n          typeof onSelectCallback === 'function' &&\n          onSelectCallback(value)\n        }\n      }}\n      value={props.value || value}\n    />\n  );\n};","export default __webpack_public_path__ + \"static/media/location-icon-atlas.37a766e0.png\";","import React from 'react';\nimport {\n  interpolateOrRd, // schemeBlues\n  interpolateReds, interpolateYlGnBu, interpolateGreens,\n  interpolateOranges, interpolateSinebow\n} from 'd3-scale-chromatic';\nimport {scaleThreshold} from 'd3-scale';\n\nimport qs from 'qs'; // warning: importing it otherways would cause minificatino issue.\n\nimport mapping from './location-icon-mapping.json';\nimport Constants from './Constants';\nimport { isString, isNumber, isObject, randomToNumber } from './JSUtils.js';\nimport IconClusterLayer from './icon-cluster-layer';\nimport { isArray } from 'underscore';\nimport csv2geojson from 'csv2geojson';\nimport { ascending } from 'd3-array';\nimport atlas from './img/location-icon-atlas.png';\nimport { sfType } from './geojsonutils';\nimport { getLayerProps } from './components/settings/settingsUtils';\n\nconst getResultsFromGoogleMaps = (string, callback) => {\n\n  if (typeof (string) === 'string' && typeof (callback) === 'function') {\n    let fullURL = \"https://maps.googleapis.com/maps/api/geocode/json?address=\" +\n      string\n      + \"&key=WRONG_KEY\";\n    fetch(fullURL)\n      .then((response) => {\n        if (response.status !== 200) {\n          console.log('Looks like there was a problem. Status Code: ' +\n            response.status);\n          return;\n        }\n        // Examine the text in the response\n        response.json()\n          .then((data) => {\n            //rouch search results will do.\n            if (data.results.length === 0 || response.status === 'ZERO_RESULTS') {\n              callback(response.status);\n            } else {\n              callback(data.results[0].geometry.location)\n            }\n          });\n      })\n      .catch((err) => {\n        console.log('Fetch Error :-S', err);\n      });\n\n  }\n  //ignore\n};\n\nconst fetchData = (url, callback) => {\n  fetch(url) // [0] => \"\", [1] => roads and [2] => qfactor\n    .then((response) => response.text())\n    .then((response) => {\n      // TODO: better check?\n      if(url.endsWith(\"csv\")) {\n        csv2geojson.csv2geojson(response, (err, data) => {\n          if (!err) {\n            typeof (callback) === 'function'\n              && callback(data)\n          }\n        })\n      } else {\n        //assume json\n        try {\n          const json = JSON.parse(response);\n          callback(json)\n        } catch (error) {\n          callback(undefined, error)\n        }\n      }\n    })\n    .catch((error) => {\n      console.error(error);\n      callback(null, error)\n    });\n\n}\n\n/**\n * \n * Simple fetch check of URL\n * \n * @param {*} URL \n * @param {*} callback \n */\nconst checkURLReachable = (URL, callback) => {\n  fetch(URL)\n  .then((response) => {\n    if(response.ok) {\n      callback(true)\n    } else {\n      callback(false)\n    }\n  })\n  .catch((error) => {\n    console.log('There has been a problem with your fetch operation: ' + error.message);\n  });\n}\n\n/**\n * Function to count frequency of values of `property` given.\n * \n * TODO: Double check to see if it is slightly different\n * version of propertyCount\n * \n * \n * @param {Object} data \n * @param {String} property \n * @param {Boolean} noNulls \n */\nconst xyObjectByProperty = (data, property, noNulls = true) => {\n  if (!data || !property) return;\n  //data = [{...data = 12/12/12}]       \n  const map = new Map()\n  data.forEach(feature => {\n    let value = feature.properties[property];\n    if (noNulls && value) { // remove nulls here\n      const isNumValue = +(value) ? +(value) : value\n      if (map.get(isNumValue)) {\n        map.set(isNumValue, map.get(isNumValue) + 1)\n      } else {\n        map.set(isNumValue, 1)\n      }\n    }\n  });\n\n  const sortedArray = Array.from(map.keys());\n\n  if(!sortedArray || !sortedArray.length) return;\n  sortedArray.sort(ascending)\n  \n  return sortedArray.map(key => {\n    return (\n      {\n        x: key,\n        y: +(map.get(key))\n      }\n    )\n  })\n}\n\nconst COLOR_RANGE = scaleThreshold()\n  .domain([-0.6, -0.45, -0.3, -0.15, 0, 0.15, 0.3, 0.45, 0.6, 0.75, 0.9, 1.05, 1.2])\n  .range([\n    [65, 182, 196],\n    [127, 205, 187],\n    [199, 233, 180],\n    [237, 248, 177],\n    // zero\n    [255, 255, 204],\n    [255, 237, 160],\n    [254, 217, 118],\n    [254, 178, 76],\n    [253, 141, 60],\n    [252, 78, 42],\n    [227, 26, 28],\n    [189, 0, 38],\n    [128, 0, 38]\n  ]);\n\nconst generateDeckLayer = (name, data, renderTooltip, options) => {\n  const addOptionsToObject = (opt, obj) => {\n    Object.keys(opt).forEach(key =>\n      obj[key] = opt[key]\n    )\n  }\n  \n /** \n * @param {String} name passed down from generateDeckLayer\n * @param {Object} data passed down from generateDeckLayer\n * @param {Object} renderTooltip passed down from generateDeckLayer\n * @returns \n */\n  function generateOptions(name, data, renderTooltip) {\n    const layerProps = getLayerProps(name);\n    if(!layerProps.class || !layerProps.class[\"value\"]) return null\n    const layerOptions = {};\n    Object.keys(layerProps).forEach(key => {\n      const type = layerProps[key] && layerProps[key].type;\n      if (type === 'number' || type === 'column') {\n        layerOptions[key] = layerProps[key].default;\n      } else if (type === 'boolean' || type === 'class') {\n        layerOptions[key] = layerProps[key].value;\n      } else {\n        layerOptions[key] = layerProps[key]\n      }\n    });\n    // common properties\n    layerOptions.data = data;\n    layerOptions.id = name + \"-layer\";\n    layerOptions.onHover = renderTooltip;\n    layerOptions.getPosition = d => d.geometry.coordinates;\n    addOptionsToObject(options, layerOptions)\n\n    return new layerProps.class[\"value\"](layerOptions);\n  }\n\n  if (name === 'icon') {\n    /**\n     * There are three files the layer need to display the icons:\n     * (1) location-icon-atlas.png which is in /public\n     * (2) ./location-icon-mapping.json which deals with mapping the icon to pixels on (1)\n     * (3) ./icon-cluster-layer.json which is a DeckGL CompositLayer component that\n     * does the clustering.\n     */\n    //icon from https://github.com/uber/deck.gl/blob/8d5b4df9e4ad41eaa1d06240c5fddb922576ee21/website/src/static/images/icon-atlas.png\n    const iconObj = {\n      id: 'icon-layer',\n      data,\n      pickable: true,\n      iconAtlas: atlas,\n      iconMapping: mapping,\n      sizeScale: 60,\n      getPosition: d => d.geometry.coordinates,\n      wrapLongitude: true,\n      // getIcon: d => 'marker-1',\n      // getSize: d => 5,\n      // getColor: d => [Math.sqrt(d.exits), 140, 0],\n      onHover: renderTooltip\n    }\n    addOptionsToObject(options, iconObj)\n    return (new IconClusterLayer(iconObj))\n  }\n\n  return generateOptions(name, data, renderTooltip)\n}\n\nconst getCentroid = (coords) => {\n  let center = coords.reduce((x, y) => {\n    return [x[0] + y[0] / coords.length, x[1] + y[1] / coords.length]\n  }, [0, 0])\n  center = [parseFloat(center[1].toFixed(3)), parseFloat(center[0].toFixed(3))]\n  return center;\n}\n\nconst convertRange = (oldValue = 2, values = \n  { oldMax: 10, oldMin: 1, newMax: 1, newMin: 0 }) => {\n  const value = (((oldValue - values.oldMin) * (values.newMax - values.newMin))\n    / (values.oldMax - values.oldMin)) + values.newMin\n  // console.log(oldValue, values);\n  return +(value.toFixed(2))\n}\n\nconst getParamsFromSearch = (search) => {\n  if (!search) return (null);\n\n  const qsResult = qs.parse(search.replace(\"?\", \"\"))\n  // 3 decimal points is street level\n  const lat = Number(qsResult.lat).toFixed(3);\n  const lng = Number(qsResult.lng).toFixed(3);\n  return ({\n    latitude: !isNaN(lat) ? Number(lat) : 53.8321,\n    longitude: !isNaN(lng) ? Number(lng) : -1.6362,\n    zoom: Number(qs.parse(search).zoom) || 10,\n    pit: Number(qs.parse(search).pit) || 55,\n    bea: Number(qs.parse(search).bea) || 0,\n    alt: Number(qs.parse(search).alt) || 1.5,\n  })\n};\n\nconst getBbx = (bounds) => {\n  if (!bounds) return null;\n  // xmin = -1.6449\n  // ymin = 53.82925\n  // xmax = -1.6270\n  // ymax = 53.8389\n  let xmin = bounds._sw.lng;\n  let xmax = bounds._ne.lng;\n  let ymin = bounds._sw.lat;\n  let ymax = bounds._ne.lat;\n  if (xmin > xmax) {\n    xmax = bounds._sw.lng;\n    xmin = bounds._ne.lng;\n  }\n  if (ymin > ymax) {\n    ymax = bounds._sw.lat;\n    ymin = bounds._ne.lat;\n  }\n  return ({ xmin, ymin, xmax, ymax })\n}\n\n/**\n * Current version simply picks up a feature out of\n * array of features, compares it to the available \n * list of DeckGL layers supported by eAtlas\n * and returns one of them.\n * \n * @param {Array} features \n * @returns \n */\nconst suggestDeckLayer = (features) => {\n  const r = randomToNumber(features && features.length)\n  if(!features || !features[r].geometry ||\n    !features[r].geometry.type) return null\n  // basic version should suggest a layer based\n  // on a simple check of a random geometry type from \n  // array of features\n  // TODO: go through each feature? in case of features.\n  const type = sfType(features[r]);\n  // Constants.LAYERSTYLES\n  if(new RegExp(\"point\", 'i').test(type)) {\n    return \"grid\"\n  } else if(new RegExp(\"line\", 'i').test(type)) {\n    return \"line\"\n  } else {\n    return \"geojson\"\n  }\n  \n}\nconst suggestUIforNumber = (number) => {\n  // \"checkbox\",     \n  // \"radio\",        \n  // \"buttongroups\", \n  // \"dropdown\",     \n  // \"slider\"])      \n  const { UI_LIST } = Constants;\n  if (!number) return UI_LIST[1];\n  if (number === 1) {\n    return UI_LIST[0];\n  } else if (number > 3 && number <= 6) {\n    return UI_LIST[1];\n  } else if (number === 2 || number === 3) {\n    return UI_LIST[2];\n  } else if (number > 9 && number < 15) {\n    return UI_LIST[3];\n  } else {\n    return UI_LIST[4]; // slider\n  }\n}\n\n/**\n * Changes a `_` separated `str` to space separated and\n * camel cases all words\n * \n * @param {*} str \n */\nconst humanize = (str) => {\n  if (!str) return str\n  let frags = str.split('_');\n  for (let i = 0; i < frags.length; i++) {\n    frags[i] = frags[i].charAt(0).toUpperCase() + frags[i].slice(1);\n  }\n  return frags.join(' ');\n}\n\nconst shortenName = (name, n = 26) => {\n  if (isNumber(name)) {\n    return parseFloat(Number.parseFloat(name).toFixed(2).toString())\n  }\n  if (!name || name.length <= n || !isString(name)) return name;\n  let shortened = name.trim();\n  const extension = name.split('.').length > 1 &&\n    name.split('.').pop().length < 10 && name.split('.').pop();\n  shortened.replace(extension, \"\");\n  if (name.length > 10) {\n    shortened = shortened.substring(0, 10) + \"...\" + (extension || \"\")\n  }\n  return (shortened);\n}\n\nconst firstLastNCharacters = (str, n = 5) => {\n  if (+str) return str;\n  return str.slice(0, n) + (str.length > n + n ?\n    \"...\" + str.slice(str.length - n, str.length) : \n    str.length > n ? \"...\" : \"\")\n}\n\nconst percentDiv = (title, left, cb, dark) => {\n  return (\n    <div\n      key={title}\n      onClick={() => typeof (cb) === 'function' && cb()}\n      style={{\n        cursor: 'pointer',\n        textAlign: 'center',\n        position: 'relative',\n        float: 'left',\n        width: '30%',\n        color: dark ? 'white' : 'black',\n        margin: '10px 2px',\n        border: '1px solid gray',\n      }}>\n      <span style={{ position: 'absolute', left: '10%' }}>\n        {title}\n      </span>\n      <div style={{\n        width: left + '%',\n        height: 20,\n        background: 'rgb(18, 147, 154)',\n        // background: 'rgb(200, 120, 0)'\n      }}>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Thanks to https://stackoverflow.com/a/34695026/2332101\n * @param {*} str \n */\nconst isURL = (str) => {\n  var a = document.createElement('a');\n  a.href = str;\n  return (a.host && a.host !== window.location.host);\n}\n\nconst isMobile = function () {\n  var check = false;\n  if (window.innerWidth < 640) return true;\n  (function (a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n  return check;\n};\n\nfunction hexToRgb(hex) {\n  let bigint = parseInt(hex.substring(1, hex.length), 16);\n  let r = (bigint >> 16) & 255;\n  let g = (bigint >> 8) & 255;\n  let b = bigint & 255;\n\n  return 'rgb(' + r + \",\" + g + \",\" + b + \")\";\n}\n\n/**\n * Generate colour scale for unique set of values\n * based on the index of a value in an array domain of the set.\n * \n * @param {any} v particular value to use in interpolateOrRd\n * @param {Array} domain domain to use in interpolateOrRd\n * @param {Number} alpha value to add to colour pallete\n * @param {String} colorName colorName found in `colorRangeNamesToInterpolate`\n */\nconst colorScale = (v, domain, alpha = 180, colorName) => {\n  if (!v || !isArray(domain) || !domain.length) return null;\n  const index = domain.indexOf(v)\n  const d3InterpolateFn = isString(colorName) && \n  colorRangeNamesToInterpolate(colorName) ? \n  colorRangeNamesToInterpolate(colorName) : interpolateOrRd;\n  let rgb = d3InterpolateFn(index / domain.length);\n  rgb = rgb.substring(4, rgb.length - 1)\n    .replace(/ /g, '')\n    .split(',').map(x => +x); // deck.gl 8 int not strings\n  return [...rgb, alpha]\n}\n\nconst colorRangeNames = ['inverseDefault', 'yellowblue', 'greens',\n  'oranges', 'diverge', 'default'];\n\nconst colorRangeNamesToInterpolate = (name) => {\n  if(!name) return interpolateOrRd;\n  if(name === colorRangeNames[0]) {\n    return interpolateReds;\n  } else if(name === colorRangeNames[1]) {\n    return interpolateYlGnBu;\n  } else if(name === colorRangeNames[2]) {\n    return interpolateGreens;\n  } else if(name === colorRangeNames[3]) {\n    return interpolateOranges;\n  } else if(name === colorRangeNames[4]) {\n    return interpolateSinebow;\n  } else {\n    return interpolateOrRd\n  }\n}\n\nconst colorRanges = (name) => {\n  if (!name) return\n  const colors = {\n    yellowblue: [\n      [255, 255, 204],\n      [199, 233, 180],\n      [127, 205, 187],\n      [65, 182, 196],\n      [44, 127, 184],\n      [37, 52, 148]\n    ],\n    greens: [\n      [237, 248, 233],\n      [199, 233, 192],\n      [161, 217, 155],\n      [116, 196, 118],\n      [49, 163, 84],\n      [0, 109, 44],\n    ],\n    oranges: [\n      [254, 237, 222],\n      [253, 208, 162],\n      [253, 174, 107],\n      [253, 141, 60],\n      [230, 85, 13],\n      [166, 54, 3],\n    ],\n    diverge: [\n      [140, 81, 10],\n      [216, 179, 101],\n      [246, 232, 195],\n      [199, 234, 229],\n      [90, 180, 172],\n      [1, 102, 94]\n    ],\n    inverseDefault: [\n      [189, 0, 38],\n      [240, 59, 32],\n      [253, 141, 60],\n      [254, 178, 76],\n      [254, 217, 118],\n      [255, 255, 178]\n    ],\n    default: [\n      [255, 255, 178],\n      [254, 217, 118],\n      [254, 178, 76],\n      [253, 141, 60],\n      [240, 59, 32],\n      [189, 0, 38],\n    ]\n  }\n  return (colors[name])\n}\n\n/**\n * TODO: much better colour array needed.\n * The purpose here was to use the same\n * colour palette used for the ranges.\n * \n * @param {String} name \n * @returns \n */\nconst getColorArray = (name) => {\n  if(!isString(name)) return null;\n  const colors = {\n    yellowblue: [0, 52, 148],\n    greens: [0, 255, 0],\n    oranges: [166, 166, 0],\n    diverge: [255, 102, 94],\n    inverseDefault: [255, 255, 178],\n    default: [189, 0, 38],\n  }\n  return (colors[name])\n}\n\nconst iconJSType = (dataType) => {\n  // describeFeatureVariables in geojsonutils\n  // String, Number, Boolean and Object\n  if (!dataType) return (null)\n  switch (dataType) {\n    case \"String\":\n      dataType = \"fa fa-globe\";\n      break;\n    case \"Number\":\n      dataType = \"fa fa-list\";\n      break;\n    case \"Object\":\n      dataType = \"fa fa-sack\";\n      break;\n    default:\n      dataType = \"fa fa-question-circle\";\n  }\n  return dataType\n}\n\nconst searchNominatom = (location, callback) => {\n  const url = \"https://nominatim.openstreetmap.org/search/\" +\n    location + \"?format=json\";\n  fetchData(url, (json) => {\n    typeof callback === 'function' && callback(json)\n  })\n}\n\nconst ATILOGO = (dark = true) => (\n  <g id=\"Page-1\" stroke=\"none\" strokeWidth=\"1\" fill=\"none\" fillRule=\"evenodd\">\n    <g id=\"ATI_logo_black_ATI_logo_black_W1024px\" fill={dark ? \"#ffffff\" : '#000000'}>\n      <g id=\"logo-line-1\" data-svg-origin=\"0.8190000057220459 0.7929999828338623\" transform=\"matrix(1,0,0,1,0,0)\" style={{ zIndex: 0, visibility: 'inherit', opacity: 1 }}>\n        <path d=\"M273.346,71.521 L233.737,71.521 C235.771,58.945 242.738,52.485 253.966,52.485 C265.183,52.485 272.837,60.128 273.346,71.521 M299.694,83.932 C299.694,52.816 282.185,33.27 254.131,33.27 C226.425,33.27 207.72,52.816 207.72,81.718 C207.72,111.985 226.08,131.363 254.983,131.363 C277.938,131.363 293.744,120.479 299.529,100.424 L272.495,100.424 C269.775,107.735 263.987,111.475 255.493,111.475 C242.573,111.475 234.588,103.654 233.902,90.05 L299.529,90.05 C299.694,87.327 299.694,84.948 299.694,83.932\" id=\"Fill-13\"></path>\n        <path d=\"M117.531,128.642 L143.027,128.642 L143.027,83.08 C143.027,63.192 148.647,53.667 160.371,53.667 C171.081,53.667 175.162,59.62 175.162,74.751 L175.162,128.642 L200.658,128.642 L200.658,72.031 C200.658,57.749 198.622,50.437 193.181,44.156 C187.738,37.861 178.392,33.78 169.209,33.78 C159.354,33.78 149.664,38.713 143.027,47.042 L143.027,0.793 L117.531,0.793 L117.531,128.642\" id=\"Fill-12\"></path>\n        <polyline id=\"Fill-11\" points=\"55.645 0.796 0.819 0.796 0.819 23.242 42.3 23.242 42.3 128.632 69.158 128.632 69.158 23.242 110.474 23.242 110.474 0.796 55.645 0.796\"></polyline>\n      </g>\n      <g id=\"logo-line-2\" transform=\"matrix(1,0,0,1,169,149)\" data-svg-origin=\"0.9760000109672546 0.0860000029206276\" style={{ zIndex: 0, visibility: 'inherit', opacity: 1 }}>\n        <path d=\"M831.16,79.656 C831.16,94.445 823.69,104.3 812.635,104.3 C801.586,104.3 794.45,94.279 794.45,78.804 C794.45,63.671 801.928,53.308 812.814,53.308 C824.03,53.308 831.16,63.506 831.16,79.656 M855.82,108.724 L855.82,35.289 L832.87,35.289 L832.87,46.848 C825.9,37.158 818.078,33.076 807.029,33.076 C784.253,33.076 768.268,52.112 768.268,78.97 C768.268,106.169 783.222,124.202 805.668,124.202 C817.571,124.202 825.05,120.451 831.85,111.281 L831.85,120.972 C831.85,137.794 826.24,145.106 813.486,145.106 C804.306,145.106 798.025,140.515 797.504,133.382 L772.173,133.382 C773.877,152.076 789.175,163.125 813.145,163.125 C835.42,163.125 849.19,154.121 853.95,136.268 C855.65,129.631 855.82,127.087 855.82,108.724\" id=\"Fill-22\"></path>\n        <path d=\"M701.193,35.283 L676.88,35.283 L676.88,127.932 L702.389,127.932 L702.389,79.994 C702.389,61.465 707.819,52.792 719.557,52.792 C724.997,52.792 729.589,55.349 732.133,59.417 C733.836,62.482 734.346,65.547 734.346,73.534 L734.346,127.932 L759.842,127.932 L759.842,75.402 C759.842,58.91 758.825,52.957 755.085,47.007 C749.476,38.168 739.951,33.249 728.227,33.249 C716.834,33.249 707.144,38.168 701.193,46.841 L701.193,35.283\" id=\"Fill-21\"></path>\n        <path d=\"M637.104,24.567 L662.601,24.567 L662.601,0.088 L637.104,0.088 L637.104,24.567 Z M637.104,127.938 L662.601,127.938 L662.601,35.285 L637.104,35.285 L637.104,127.938 Z\" id=\"Fill-20\"></path>\n        <path d=\"M569.69,127.936 L595.186,127.936 L595.186,86.965 C595.186,64.189 601.991,55.339 619.334,55.339 C622.055,55.339 623.747,55.515 626.467,56.191 L626.467,34.09 C624.089,33.238 622.564,33.073 619.676,33.073 C608.106,33.073 598.926,38.172 594.004,47.352 L594.004,35.286 L569.69,35.286 L569.69,127.936\" id=\"Fill-19\"></path>\n        <path d=\"M532.476,127.936 L556.789,127.936 L556.789,35.286 L531.28,35.286 L531.28,83.225 C531.28,93.259 530.442,98.358 527.884,102.44 C524.822,107.538 519.721,110.424 514.112,110.424 C508.672,110.424 504.08,108.048 501.536,103.798 C499.833,100.737 499.323,97.672 499.323,89.685 L499.323,35.286 L473.827,35.286 L473.827,87.816 C473.827,104.308 474.847,110.259 478.584,116.212 C484.193,125.05 493.883,129.97 505.442,129.97 C516.67,129.97 526.36,125.05 532.476,116.377 L532.476,127.936\" id=\"Fill-18\"></path>\n        <polyline id=\"Fill-17\" points=\"425.87 127.936 452.728 127.936 452.728 22.531 494.041 22.531 494.041 0.086 384.389 0.086 384.389 22.531 425.87 22.531 425.87 127.936\"></polyline>\n        <path d=\"M287.694,35.283 L263.38,35.283 L263.38,127.932 L288.89,127.932 L288.89,79.994 C288.89,61.465 294.319,52.792 306.057,52.792 C311.498,52.792 316.089,55.349 318.633,59.417 C320.336,62.482 320.846,65.547 320.846,73.534 L320.846,127.932 L346.342,127.932 L346.342,75.402 C346.342,58.91 345.325,52.957 341.585,47.007 C335.977,38.168 326.452,33.249 314.728,33.249 C303.334,33.249 293.644,38.168 287.694,46.841 L287.694,35.283\" id=\"Fill-16\"></path>\n        <path d=\"M226.718,85.77 C226.718,102.428 219.24,111.952 206.144,111.952 C197.991,111.952 192.206,107.364 192.206,101.08 C192.206,93.934 198.501,90.362 214.472,87.818 L223.322,86.456 C223.653,86.28 224.849,86.115 226.718,85.77 M250.687,87.473 C250.852,80.671 250.852,76.59 250.852,74.553 C250.852,57.388 248.818,50.077 241.851,43.272 C235.046,36.305 224.339,32.565 210.912,32.565 C186.088,32.565 170.448,44.468 169.254,64.356 L195.436,64.356 C195.944,55.175 201.221,50.584 211.419,50.584 C221.961,50.584 226.552,56.192 226.718,69.278 C215.5,69.964 200.37,72.177 192.041,74.388 C174.353,78.635 165.68,87.818 165.68,101.92 C165.68,118.413 179.451,129.971 199.353,129.971 C214.307,129.971 223.653,125.049 230.457,113.656 L230.457,117.396 C230.457,120.967 230.623,122.839 231.309,127.937 L253.244,127.937 C251.373,120.116 250.687,110.935 250.687,96.147 L250.687,87.473\" id=\"Fill-15\"></path>\n        <polygon id=\"Fill-14\" points=\"130.939 127.937 156.435 127.937 156.435 0.087 130.939 0.087\"></polygon>\n        <path d=\"M79.347,73.37 L45.508,73.37 L62.51,20.319 L79.347,73.37 Z M125.075,127.937 L80.529,0.087 L45.343,0.087 L0.976,127.937 L28.341,127.937 L38.541,96.311 L86.659,96.311 L97.024,127.937 L125.075,127.937 Z\" id=\"Fill-1\"></path>\n      </g>\n      <g id=\"logo-line-3\" transform=\"matrix(1,0,0,1,24,297)\" data-svg-origin=\"0.7670000195503235 0.34700000286102295\" style={{ zIndex: 0, visibility: 'inherit', opacity: 1 }}>\n        <path d=\"M592.476,71.073 L552.866,71.073 C554.9,58.497 561.868,52.037 573.096,52.037 C584.313,52.037 591.966,59.68 592.476,71.073 M618.824,83.484 C618.824,52.368 601.315,32.822 573.261,32.822 C545.552,32.822 526.849,52.368 526.849,81.273 C526.849,111.537 545.21,130.915 574.113,130.915 C597.068,130.915 612.874,120.031 618.659,99.976 L591.625,99.976 C588.902,107.29 583.117,111.028 574.623,111.028 C561.702,111.028 553.718,103.206 553.032,89.602 L618.659,89.602 C618.824,86.879 618.824,84.501 618.824,83.484\" id=\"Fill-10\"></path>\n        <path d=\"M521.303,35.543 L506.348,35.543 L506.348,13.1 L480.839,13.1 L480.839,35.543 L467.246,35.543 L467.246,54.758 L480.839,54.758 L480.839,97.256 C480.839,109.501 481.858,114.765 485.43,120.029 C490.187,127.175 497.168,130.24 508.548,130.24 C513.826,130.24 516.546,129.898 521.303,128.702 L521.303,109.666 C518.238,110.008 517.221,110.173 516.039,110.173 C509.058,110.173 506.348,106.271 506.348,96.236 L506.348,54.758 L521.303,54.758 L521.303,35.543\" id=\"Fill-9\"></path>\n        <path d=\"M434.281,128.196 L458.595,128.196 L458.595,35.546 L433.085,35.546 L433.085,83.485 C433.085,93.52 432.247,98.618 429.69,102.7 C426.625,107.799 421.527,110.684 415.918,110.684 C410.478,110.684 405.886,108.308 403.342,104.061 C401.639,100.997 401.129,97.932 401.129,89.945 L401.129,35.546 L375.633,35.546 L375.633,88.076 C375.633,104.568 376.65,110.519 380.39,116.472 C385.998,125.31 395.689,130.23 407.247,130.23 C418.476,130.23 428.163,125.31 434.281,116.637 L434.281,128.196\" id=\"Fill-8\"></path>\n        <path d=\"M364.433,35.543 L349.479,35.543 L349.479,13.1 L323.969,13.1 L323.969,35.543 L310.376,35.543 L310.376,54.758 L323.969,54.758 L323.969,97.256 C323.969,109.501 324.989,114.765 328.56,120.029 C333.317,127.175 340.298,130.24 351.678,130.24 C356.956,130.24 359.676,129.898 364.433,128.702 L364.433,109.666 C361.368,110.008 360.351,110.173 359.169,110.173 C352.188,110.173 349.479,106.271 349.479,96.236 L349.479,54.758 L364.433,54.758 L364.433,35.543\" id=\"Fill-7\"></path>\n        <path d=\"M288.764,0.347 L276.009,0.347 L276.009,24.823 L301.519,24.823 L301.519,0.347 L288.764,0.347 Z M288.764,35.533 L276.009,35.533 L276.009,128.197 L301.519,128.197 L301.519,35.533 L288.764,35.533 Z\" id=\"Fill-6\"></path>\n        <path d=\"M265.918,35.543 L250.964,35.543 L250.964,13.1 L225.454,13.1 L225.454,35.543 L211.862,35.543 L211.862,54.758 L225.454,54.758 L225.454,97.256 C225.454,109.501 226.474,114.765 230.046,120.029 C234.803,127.175 241.784,130.24 253.164,130.24 C258.441,130.24 261.162,129.898 265.918,128.702 L265.918,109.666 C262.854,110.008 261.837,110.173 260.654,110.173 C253.673,110.173 250.964,106.271 250.964,96.236 L250.964,54.758 L265.918,54.758 L265.918,35.543\" id=\"Fill-5\"></path>\n        <path d=\"M207.476,65.123 C207.641,44.891 193.194,32.825 168.373,32.825 C144.404,32.825 129.105,44.384 129.105,62.238 C129.105,69.029 131.991,75.83 137.092,80.422 C142.877,85.697 148.993,88.076 165.995,91.65 C178.57,94.359 183.162,97.421 183.162,103.209 C183.162,108.638 177.553,112.213 169.059,112.213 C158.341,112.213 152.732,107.111 152.909,97.256 L126.892,97.256 C127.236,118.849 142.367,130.918 168.883,130.918 C194.048,130.918 209.689,119.357 209.689,100.83 C209.689,86.714 201.36,78.209 182.997,73.452 L164.633,68.698 C157.666,66.826 154.601,64.272 154.601,60.19 C154.601,54.581 159.369,51.186 167.356,51.186 C177.719,51.186 181.98,55.091 182.487,65.123 L207.476,65.123\" id=\"Fill-4\"></path>\n        <path d=\"M61.442,35.543 L37.128,35.543 L37.128,128.192 L62.638,128.192 L62.638,80.254 C62.638,61.725 68.068,53.055 79.806,53.055 C85.246,53.055 89.838,55.609 92.381,59.68 C94.085,62.742 94.594,65.807 94.594,73.794 L94.594,128.192 L120.091,128.192 L120.091,75.662 C120.091,59.17 119.074,53.22 115.334,47.267 C109.725,38.428 100.2,33.509 88.476,33.509 C77.083,33.509 67.392,38.428 61.442,47.102 L61.442,35.543\" id=\"Fill-3\"></path>\n        <polyline id=\"Fill-2\" points=\"13.508 0.347 0.767 0.347 0.767 128.197 26.249 128.197 26.249 0.347 13.508 0.347\"></polyline>\n      </g>\n    </g>\n  </g>\n)\n\n/**\n * \n * @param {*} options \n */\nconst generateLegend = (options) => {\n  //quick check \n  const { domain, interpolate = interpolateOrRd, title } = options;\n  const r = randomToNumber(domain && domain.length)\n  if (!domain || !Array.isArray(domain) || !isNumber(domain[r])) return\n  const jMax = domain[domain.length - 1], jMin = domain[0];\n  const legend = [<p key='title'>{title}</p>]\n\n  for (var i = 0; i < 10; i += 1) {\n    legend.push(\n      <>\n        {i === 0 &&\n          <i>{(title === humanize('Mean.Travel.Time..Seconds.') ?\n            +(jMin) / 300 : jMin).toFixed(2)\n          }</i>\n        }\n        <span key={i} style={{ background: interpolate(i / 10) }}>\n        </span>\n        {i === 9 &&\n          <i>{(title === humanize('Mean.Travel.Time..Seconds.') ?\n            +(jMax) / 300 : jMax).toFixed(2)\n          }</i>\n        }\n      </>)\n  }\n  return legend;\n}\n\n/**\n * \n * @param {*} data features from a geojson object\n * @param {*} column \n */\nconst generateDomain = (data, column) => {\n  if (!data || !Array.isArray(data) || !column || !data.length) return;\n  let domainIsNumeric = true;\n  let domain = [];\n  data.forEach(feature => {\n    // uber move to show isochrones\n    const i = feature.properties[\n      +(column) ? Object.keys(feature.properties)[column] : column\n    ]; // eliminate nulls\n    if(!i) return;\n    if (+(i) &&\n      column === 'Mean.Travel.Time..Seconds.') {\n        domain.push(Math.floor(i / 300));\n    } else {\n      if(+(i)) {\n        domain.push(+(i))\n      } else {\n        domainIsNumeric = false;\n        domain.push(i)\n      }\n    }\n  });\n  domain = Array.from(new Set(domain));\n  // sort the domain if possible\n  if (domainIsNumeric) {\n    domain = domain.sort((a, b) => { return (a - b); });\n  }\n  return domain\n}\n\nconst sortNumericArray = (array) => {\n  let domainIsNumeric = true;\n  // sort the domain if possible\n  array.map(e => !isNumber(e) && (domainIsNumeric = false))\n  if (domainIsNumeric) {\n    array = array.sort((a, b) => { return (a - b); });\n  }\n  return array\n}\n\nconst getMax = (arr) => {\n  return arr.reduce((max, v) => max >= v ? max : v, -Infinity);\n}\nconst getMin = (arr) => {\n  return arr.reduce((max, v) => max <= v ? max : v, Infinity);\n}\n\nconst OSMTILES = {\n  \"version\": 8,\n  \"sources\": {\n    \"simple-tiles\": {\n      \"type\": \"raster\",\n      \"tiles\": [\n        // \"http://tile.openstreetmap.org/{z}/{x}/{y}.png\",\n        // \"http://b.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        // \"http://tile.stamen.com/toner/{z}/{x}/{y}.png\"\n        'https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg'\n      ],\n      \"tileSize\": 256\n    }\n  },\n  \"layers\": [{\n    \"id\": \"simple-tiles\",\n    \"type\": \"raster\",\n    \"source\": \"simple-tiles\",\n  }]\n};\n\n/**\n * \n * Function modifies `geojson` in place.\n * \n * @param {*} geojson a gejson with matching `geoColumn` to `data` param\n * {features:[], type:}\n * @param {*} data a json {properties:{}} object with matchin \n * `geoColumn` to `geojson` param. Typically features of another geojons.\n * @param {*} geoColumn geocode which is shared between `geojson` and `data`\n */\nconst setGeojsonProps = (geojson, data, geoColumn) => {\n  // const r = randomToNumber(data && data.length);\n  const r = 0;\n  const result = Object.assign({}, geojson)\n  result.features = []\n  if (!isObject(geojson) || !isArray(data) || !isString(geoColumn) ||\n    !geojson.features || !geojson.features[r] ||\n    !geojson.features[r].properties[geoColumn] || !data[r] || \n    !data[r].properties || !data[r].properties[geoColumn]) return null\n  // for now modify the object itself\n  geojson.features.forEach(feature => {\n    for (let i = 0; i < data.length; i++) {\n      if (feature.properties[geoColumn] === data[i].properties[geoColumn]) {\n        // feature.properties = data[i].properties;\n        const obj = {\n          type: feature.type,\n          properties: data[i].properties,\n          geometry: feature.geometry\n        }\n        result.features.push(obj)\n        break;\n      }\n    }\n  });\n  return result\n}\n\n/**\n * \n * @param {Object} obj Object with keys to compare keys to\n * regex\n * \n * @returns first key in the objec that matches the regex\n */\nconst getFirstDateColumnName = (obj) => {\n  if(!isObject(obj) || !Object.keys(obj)) return null\n  // find the date/time column with year in\n  const r = new RegExp(Constants.DATE_REGEX);\n  return Object.keys(obj).filter(e => r.test(e))[0]\n}\n\nconst getMessage = (array) => {\n  return array && array.length &&\n  array.length + \" row\" + (array.length > 1 ? \"s\" : \"\")\n}\nconst getMainMessage = (filtered, unfiltered) => {\n  if(filtered && filtered.length && unfiltered && unfiltered.length) {\n    return getMessage(filtered) + (filtered.length < unfiltered.length ? \n    \" of \" + unfiltered.length : \"\")\n  } else if(filtered && filtered.length) {\n    return getMessage(filtered)\n    // TODO: check all rows before declaring\n  } else if(unfiltered && unfiltered.length && \n    !unfiltered[randomToNumber(unfiltered.length)].geometry) {\n    return getMessage(unfiltered) + \" - no geometry\"\n  } else {\n    return \"Nothing to show\"\n  }\n}\nexport {\n  colorRangeNamesToInterpolate,\n  getResultsFromGoogleMaps,\n  getFirstDateColumnName,\n  firstLastNCharacters,\n  getParamsFromSearch,\n  xyObjectByProperty,\n  suggestUIforNumber,\n  generateDeckLayer,\n  checkURLReachable,\n  suggestDeckLayer,\n  sortNumericArray,\n  setGeojsonProps,\n  colorRangeNames,\n  searchNominatom,\n  generateLegend,\n  generateDomain,\n  getMainMessage,\n  getColorArray,\n  convertRange,\n  getCentroid,\n  shortenName,\n  colorRanges,\n  COLOR_RANGE,\n  percentDiv,\n  iconJSType,\n  colorScale,\n  fetchData,\n  OSMTILES,\n  humanize,\n  isMobile,\n  ATILOGO,\n  getBbx,\n  getMin,\n  getMax,\n  isURL,\n}","import * as helpers from '@turf/helpers';\n\nimport { fetchData } from '../../utils';\nimport { DEV_URL, PRD_URL } from '../../Constants';\n\nconst URL = (process.env.NODE_ENV === 'development' ? DEV_URL : PRD_URL);\n\n  /**\n   * The logic here is simple even if the code is not:\n   * Unique object of all \"geography\" with corresponding code in data[1]\n   * \n   * Then using turfjs generate geojson features using data[0] (json) values\n   * and \"geography\" from the data[1].\n   * \n   * Then return the \"collection\"\n   */\n\nconst fetchSPENSER = (callback) => {\n  const fullURL = URL + '/api/spenser2';\n  fetchData(fullURL, (data, error) => {\n    console.log(data.length);\n    \n    if (!error && data[1]) {\n      console.log(JSON.parse(data[1]))\n      let collection = [];\n      const map_code_point = {}\n      JSON.parse(data[1]).features.forEach(f => {\n        map_code_point[f.properties.Area] =\n          f.geometry.coordinates\n      })\n      for (let index = 0; index < data[0].length; index++) {\n        let e = data[0][index]; //just too large for forEach.\n        const line = helpers.multiPolygon(\n          map_code_point[e.c] // in the data Area is c for code\n          , //properties next\n          { code:e.c, age:e.a, sex: e.s, ethnicity: e.e, year: e.y }\n        )        \n        collection.push(line)\n      }\n      collection = helpers.featureCollection(collection);\n      console.log(collection);\n      \n      callback && callback(collection)\n    } else {\n      console.log(error);\n    }\n  })\n}\n\nconst fetchQuant = (callback) => {\n  const fullURL = URL + '/api/quant';\n  // console.log(fullURL);\n\n  fetchData(fullURL, (data, error) => {\n    if (!error && data.length == 2) {\n      // console.log(JSON.parse(data[1]))\n      let collection = [];\n      const map_code_point = {}\n      JSON.parse(data[1]).features.forEach(f => {\n        map_code_point[f.properties.msoa11cd] =\n          f.geometry.coordinates\n      })\n      data[0].forEach(e => {\n        const line = helpers.lineString([\n          map_code_point[e.origin_msoacode],\n          map_code_point[e.destination_msoacode],\n        ], //properties next\n          { base: +(e.base), hs2: +(e.data) }\n        )\n        if (line.geometry.coordinates[0] && line.geometry.coordinates[1]) {\n          collection.push(line)\n        }\n      })\n      collection = helpers.featureCollection(collection);\n      // console.log(collection);\n      \n      callback && callback(collection, fullURL)\n    } else {\n      console.log(error);\n    }\n  })\n}\nexport {\n  fetchSPENSER,\n  fetchQuant\n}","import * as React from 'react';\nimport {\n  Card,\n  StyledBody,\n  StyledAction,\n} from 'baseui/card';\nimport { Button } from 'baseui/button';\nexport default (props) => {\n  if (!props) {\n    return null;\n  }\n  return (\n    <Card\n      // overrides={{ Root: { style: { width: props.width || '128px' } } }}\n      headerImage={props.image}\n      title={props.title}\n    >\n      <StyledBody>\n        {props.body}\n      </StyledBody>\n      <StyledAction>\n        <Button\n          onClick={() => typeof props.loadCallback === 'function' &&\n            props.loadCallback()}\n          overrides={{ BaseButton: { style: { width: '100%' } } }}>\n          {props.button}\n        </Button>\n      </StyledAction>\n    </Card>\n  );\n}","import * as React from 'react';\nimport { Button, KIND, SIZE } from 'baseui/button';\nimport {\n  Modal,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n  ModalButton,\n  FocusOnce,\n} from 'baseui/modal';\nimport { FlexGrid, FlexGridItem } from 'baseui/flex-grid';\nimport { fetchQuant } from './showcases/util_quant';\n\nimport File from './File'\nimport URL from './URL';\nimport Card from './Card';\nimport { DEV_URL, PRD_URL } from '../Constants';\n\n/**\n * The package is by mapbox. \n * \n * GDAL specs have been taken into consideration according to\n * package docs. The package creats lines and polygons from \n * correct csv files.\n * \n * There has been good effort into guessing the naming of\n * lat/longs, see \n * https://github.com/mapbox/csv2geojson/blob/gh-pages/index.js\n * \n * From the package\n * var latRegex = /(Lat)(itude)?/gi,\n *  lonRegex = /(L)(on|ng)(gitude)?/i;\n * \n */\nconst csv2geojson = require('csv2geojson');\n\nconst partURL = (process.env.NODE_ENV === 'development' ? DEV_URL : PRD_URL);\n\nexport default function (props) {\n  const [isOpen, setOpen] = React.useState(false);\n  const { urlCallback, toggleOpen } = props;\n\n  function cards() {\n    const info = {\n      // SPENSER2: {\n      //   image: \"images/spenser.png\",\n      //   body: \"SPENSER Manchester 2011 - 2020.\",\n      //   api: fetchSPENSER\n      // },\n      SPENSER: {\n        image: \"images/spenser.png\",\n        body: \"SPENSER Cambridge sample.\",\n        api: partURL + '/api/spenser'\n      },\n      QUANT: {\n        image: \"images/quant.png\",\n        body: \"QUANT HS2 scenario example.\",\n        api: fetchQuant // a function\n      },\n    };\n    return (Object.keys(info).map(key =>\n      <FlexGridItem key={key} {...itemProps}>\n        {\n          <Card button=\"Load\" title={key} image={info[key]['image']}\n            body={info[key]['body']} loadCallback={() => {\n              const api = info[key]['api'];\n              // if api is function call and provied\n              // geojson returned in case of quant for instance.\n              api && typeof (api) === 'function' ?\n                api((geojson, apiURL) => urlCallback(undefined, geojson, apiURL)) :\n                typeof (urlCallback) === 'function'\n                && urlCallback(api)\n              setOpen(false);\n            }} />\n        }\n      </FlexGridItem>\n\n    ))\n  }\n\n\n  return (\n    <React.Fragment>\n      <Button\n        kind={KIND.secondary} size={SIZE.compact}\n        onClick={() => {\n          setOpen(s => !s); // or s === isOpen\n          typeof toggleOpen === 'function' && toggleOpen()\n        }}>Add data</Button>\n      <Modal\n        onClose={() => {\n          typeof (toggleOpen) === 'function' && toggleOpen()\n          setOpen(false);\n        }}\n        isOpen={isOpen}>\n        <ModalHeader>Your data remains on your browser. It is NOT uploaded anywhere.</ModalHeader>\n        <ModalBody>\n          <FocusOnce>\n            <URL urlCallback={(url) => {\n              setOpen(false);\n              typeof (urlCallback) === 'function'\n                && urlCallback(url)\n            }} />\n          </FocusOnce>\n          <File contentCallback={({ text, name }) => {\n            if (name && (name.split(\".\")[1].match(/geo/) //test.json\n              || name.split(\".\")[1].match(/json/))) {\n              try {\n                const json = JSON.parse(text);\n                typeof (urlCallback) === 'function'\n                  && urlCallback(null, json, name)\n                setOpen(false);\n              } catch (e) {\n                console.log(e);\n              }\n            } else {\n              // err has any parsing errors\n              csv2geojson.csv2geojson(text, (err, data) => {\n                if (!err) {\n                  typeof (urlCallback) === 'function'\n                    && urlCallback(null, data, name)\n                }\n              });\n            }\n          }} />\n          <FlexGrid\n            flexGridColumnCount={3}\n            flexGridColumnGap=\"scale800\"\n            flexGridRowGap=\"scale800\"\n          >\n            {!process.env.NO_CARDS && cards()}\n          </FlexGrid>\n        </ModalBody>\n        <ModalFooter>\n          <ModalButton onClick={() => {\n            setOpen(false);\n            typeof (toggleOpen) === 'function' && toggleOpen();\n          }}>Close</ModalButton>\n        </ModalFooter>\n      </Modal>\n    </React.Fragment >\n  );\n}\n\nconst itemProps = {\n  // backgroundColor: 'mono300',\n  // height: 'scale1000',\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n};","import React from 'react';\nimport MultiSelect from './MultiSelect';\n\nexport default class MapboxBaseLayers extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            bases: [\n                'dark',\n                'basic',\n                'streets',\n                'bright',\n                'light',\n                'satellite',\n                'No map'\n            ],\n            selected: props.dark ? \"dark\" : \"streets\"\n        }\n    }\n\n    render() { \n        const {selected, bases} = this.state;\n        const {onSelectCallback, dark} = this.props;\n        // console.log(selected);\n        \n        return(\n          <MultiSelect\n            title={selected === 'dark' ? \"Default(dark)\" : \n            !dark ? \"Default(streets)\" : selected}\n            single={true}\n            values={\n              bases.map(e => ({ id: e, value: e }))\n            }\n            onSelectCallback={(selected) => {\n              if(selected && selected.length) {\n                this.setState({ selected: selected[0].value });\n                typeof (onSelectCallback) === 'function' &&\n                  onSelectCallback(selected[0].value)\n              }\n            }}\n          />\n        )\n    }\n}","import React, { Component } from 'react';\n\n// react bootstrap\nimport { Alert } from 'react-bootstrap';\n\n// local\n\nclass ToastAlert extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      timeDuration: false\n    }\n  }\n\n  // lifeCycles\n  //-----------------------------------------------\n  componentWillUnmount() {\n    if (this.dismissTimeoutId) clearTimeout(this.dismissTimeoutId)\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (!nextProps.alert) return;\n    const oldId = this.props.alert;\n    const newId = nextProps.alert;\n    if (oldId !== newId) {\n      const { time } = nextProps.alert;\n      this.setState({\n        timeDuration: Boolean(alert)\n      },\n        () => {\n          this.dismissTimeout = setTimeout(() => this.setState({ timeDuration: false }),\n            time || 5000)\n        });\n    }\n  }\n\n  // local methods\n\n  // render\n  render() {\n    const { alert } = this.props;\n    const { timeDuration } = this.state;\n\n    if (!timeDuration || !alert || !alert.content)\n      return null;\n\n    else {\n      return (\n        <Alert style={{\n          border: 'none',\n          background: '#f8d7da',\n          color: '#721c24',\n          textAlign: 'center'\n        }} variant={\"danger\"} >\n          {alert.content}\n        </Alert>\n      )\n\n    }\n  }\n}\nexport default ToastAlert;\n","import React, { useState } from 'react';\nimport { colorRangeNames} from '../utils';\n\nexport default function ColorPicker(props) {\n  const [chosen, setChosen] = useState(0);\n  const { colourCallback } = props;\n  return (\n    <div className=\"color-picker-container\">\n      <p>Color:</p>\n      {\n        colorRangeNames.map((each, i) => {\n            return (\n              <div\n                key={each}\n                style={{\n                  backgroundColor: i === 0 ? 'red' :\n                    i === 1 ? 'blue' : i === 2 ? 'green' :\n                      i === 3 ? 'orange' : i === 4 ? 'brown' : 'yellow'\n                }}\n                className={\"color-box\" + (chosen === i ? \" color-box-active\" : \"\")}\n                onClick={() => {\n                  setChosen(i)              \n                  typeof colourCallback === 'function' &&\n                    colourCallback(each)\n                }}/>\n            )\n          })\n      }\n    </div>\n  )\n}","import * as React from 'react';\nimport { Button, KIND, SIZE } from 'baseui/button';\nimport {\n  Modal,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n} from 'baseui/modal';\n\nexport default (props) => {\n  const [open, setOpen] = React.useState(false);\n  const { toggleOpen, title, component, button } = props;\n\n  return (\n    <React.Fragment>\n      <i\n        style={{\n          margin: 5,\n          cursor: 'pointer',\n          fontSize: '1.5em'\n        }}\n        onClick={() => {\n          typeof toggleOpen === 'function' && toggleOpen();\n          setOpen(true);\n        }}\n        className={button || \"fa fa-table\"}></i>\n      <Modal size=\"80%\"\n        onClose={() => {\n          typeof (toggleOpen) === 'function' && toggleOpen()\n          setOpen(false);\n        }} isOpen={open}>\n        <ModalHeader>{title}</ModalHeader>\n        <ModalBody>\n          {component}\n        </ModalBody>\n        <ModalFooter>\n          <Button\n            kind={KIND.secondary} size={SIZE.compact}\n            onClick={() => {\n              setOpen(false);\n              typeof (toggleOpen) === 'function' && toggleOpen();\n            }}>Okay</Button>\n        </ModalFooter>\n      </Modal>\n    </React.Fragment>\n  );\n};","/* eslint-disable react/forbid-foreign-prop-types */\nimport React, {Component} from 'react';\nimport PropTypes from 'prop-types';\n\n// The naming convention is:\n//   - events are attached as `'plotly_' + eventName.toLowerCase()`\n//   - react props are `'on' + eventName`\nconst eventNames = [\n  'AfterExport',\n  'AfterPlot',\n  'Animated',\n  'AnimatingFrame',\n  'AnimationInterrupted',\n  'AutoSize',\n  'BeforeExport',\n  'BeforeHover',\n  'ButtonClicked',\n  'Click',\n  'ClickAnnotation',\n  'Deselect',\n  'DoubleClick',\n  'Framework',\n  'Hover',\n  'LegendClick',\n  'LegendDoubleClick',\n  'Relayout',\n  'Relayouting',\n  'Restyle',\n  'Redraw',\n  'Selected',\n  'Selecting',\n  'SliderChange',\n  'SliderEnd',\n  'SliderStart',\n  'SunburstClick',\n  'Transitioning',\n  'TransitionInterrupted',\n  'Unhover',\n  'WebGlContextLost',\n];\n\nconst updateEvents = [\n  'plotly_restyle',\n  'plotly_redraw',\n  'plotly_relayout',\n  'plotly_relayouting',\n  'plotly_doubleclick',\n  'plotly_animated',\n  'plotly_sunburstclick',\n];\n\n// Check if a window is available since SSR (server-side rendering)\n// breaks unnecessarily if you try to use it server-side.\nconst isBrowser = typeof window !== 'undefined';\n\nexport default function plotComponentFactory(Plotly) {\n  class PlotlyComponent extends Component {\n    constructor(props) {\n      super(props);\n\n      this.p = Promise.resolve();\n      this.resizeHandler = null;\n      this.handlers = {};\n\n      this.syncWindowResize = this.syncWindowResize.bind(this);\n      this.syncEventHandlers = this.syncEventHandlers.bind(this);\n      this.attachUpdateEvents = this.attachUpdateEvents.bind(this);\n      this.getRef = this.getRef.bind(this);\n      this.handleUpdate = this.handleUpdate.bind(this);\n      this.figureCallback = this.figureCallback.bind(this);\n      this.updatePlotly = this.updatePlotly.bind(this);\n    }\n\n    updatePlotly(shouldInvokeResizeHandler, figureCallbackFunction, shouldAttachUpdateEvents) {\n      this.p = this.p\n        .then(() => {\n          if (this.unmounting) {\n            return;\n          }\n          if (!this.el) {\n            throw new Error('Missing element reference');\n          }\n          // eslint-disable-next-line consistent-return\n          return Plotly.react(this.el, {\n            data: this.props.data,\n            layout: this.props.layout,\n            config: this.props.config,\n            frames: this.props.frames,\n          });\n        })\n        .then(() => {\n          if (this.unmounting) {\n            return;\n          }\n          this.syncWindowResize(shouldInvokeResizeHandler);\n          this.syncEventHandlers();\n          this.figureCallback(figureCallbackFunction);\n          if (shouldAttachUpdateEvents) {\n            this.attachUpdateEvents();\n          }\n        })\n        .catch((err) => {\n          if (this.props.onError) {\n            this.props.onError(err);\n          }\n        });\n    }\n\n    componentDidMount() {\n      this.unmounting = false;\n\n      this.updatePlotly(true, this.props.onInitialized, true);\n    }\n\n    componentDidUpdate(prevProps) {\n      this.unmounting = false;\n\n      // frames *always* changes identity so fall back to check length only :(\n      const numPrevFrames =\n        prevProps.frames && prevProps.frames.length ? prevProps.frames.length : 0;\n      const numNextFrames =\n        this.props.frames && this.props.frames.length ? this.props.frames.length : 0;\n\n      const figureChanged = !(\n        prevProps.layout === this.props.layout &&\n        prevProps.data === this.props.data &&\n        prevProps.config === this.props.config &&\n        numNextFrames === numPrevFrames\n      );\n      const revisionDefined = prevProps.revision !== void 0;\n      const revisionChanged = prevProps.revision !== this.props.revision;\n\n      if (!figureChanged && (!revisionDefined || (revisionDefined && !revisionChanged))) {\n        return;\n      }\n\n      this.updatePlotly(false, this.props.onUpdate, false);\n    }\n\n    componentWillUnmount() {\n      this.unmounting = true;\n\n      this.figureCallback(this.props.onPurge);\n\n      if (this.resizeHandler && isBrowser) {\n        window.removeEventListener('resize', this.resizeHandler);\n        this.resizeHandler = null;\n      }\n\n      this.removeUpdateEvents();\n\n      Plotly.purge(this.el);\n    }\n\n    attachUpdateEvents() {\n      if (!this.el || !this.el.removeListener) {\n        return;\n      }\n\n      updateEvents.forEach((updateEvent) => {\n        this.el.on(updateEvent, this.handleUpdate);\n      });\n    }\n\n    removeUpdateEvents() {\n      if (!this.el || !this.el.removeListener) {\n        return;\n      }\n\n      updateEvents.forEach((updateEvent) => {\n        this.el.removeListener(updateEvent, this.handleUpdate);\n      });\n    }\n\n    handleUpdate() {\n      this.figureCallback(this.props.onUpdate);\n    }\n\n    figureCallback(callback) {\n      if (typeof callback === 'function') {\n        const {data, layout} = this.el;\n        const frames = this.el._transitionData ? this.el._transitionData._frames : null;\n        const figure = {data, layout, frames};\n        callback(figure, this.el);\n      }\n    }\n\n    syncWindowResize(invoke) {\n      if (!isBrowser) {\n        return;\n      }\n\n      if (this.props.useResizeHandler && !this.resizeHandler) {\n        this.resizeHandler = () => Plotly.Plots.resize(this.el);\n        window.addEventListener('resize', this.resizeHandler);\n        if (invoke) {\n          this.resizeHandler();\n        }\n      } else if (!this.props.useResizeHandler && this.resizeHandler) {\n        window.removeEventListener('resize', this.resizeHandler);\n        this.resizeHandler = null;\n      }\n    }\n\n    getRef(el) {\n      this.el = el;\n\n      if (this.props.debug && isBrowser) {\n        window.gd = this.el;\n      }\n    }\n\n    // Attach and remove event handlers as they're added or removed from props:\n    syncEventHandlers() {\n      eventNames.forEach((eventName) => {\n        const prop = this.props['on' + eventName];\n        const handler = this.handlers[eventName];\n        const hasHandler = Boolean(handler);\n\n        if (prop && !hasHandler) {\n          this.addEventHandler(eventName, prop);\n        } else if (!prop && hasHandler) {\n          // Needs to be removed:\n          this.removeEventHandler(eventName);\n        } else if (prop && hasHandler && prop !== handler) {\n          // replace the handler\n          this.removeEventHandler(eventName);\n          this.addEventHandler(eventName, prop);\n        }\n      });\n    }\n\n    addEventHandler(eventName, prop) {\n      this.handlers[eventName] = prop;\n      this.el.on(this.getPlotlyEventName(eventName), this.handlers[eventName]);\n    }\n\n    removeEventHandler(eventName) {\n      this.el.removeListener(this.getPlotlyEventName(eventName), this.handlers[eventName]);\n      delete this.handlers[eventName];\n    }\n\n    getPlotlyEventName(eventName) {\n      return 'plotly_' + eventName.toLowerCase();\n    }\n\n    render() {\n      return (\n        <div\n          id={this.props.divId}\n          style={this.props.style}\n          ref={this.getRef}\n          className={this.props.className}\n        />\n      );\n    }\n  }\n\n  PlotlyComponent.propTypes = {\n    data: PropTypes.arrayOf(PropTypes.object),\n    config: PropTypes.object,\n    layout: PropTypes.object,\n    frames: PropTypes.arrayOf(PropTypes.object),\n    revision: PropTypes.number,\n    onInitialized: PropTypes.func,\n    onPurge: PropTypes.func,\n    onError: PropTypes.func,\n    onUpdate: PropTypes.func,\n    debug: PropTypes.bool,\n    style: PropTypes.object,\n    className: PropTypes.string,\n    useResizeHandler: PropTypes.bool,\n    divId: PropTypes.string,\n  };\n\n  eventNames.forEach((eventName) => {\n    if(PlotlyComponent.propTypes) {\n      PlotlyComponent.propTypes['on' + eventName] = PropTypes.func;\n    }\n  });\n\n  PlotlyComponent.defaultProps = {\n    debug: false,\n    useResizeHandler: false,\n    data: [],\n    style: {position: 'relative', display: 'inline-block'},\n  };\n\n  return PlotlyComponent;\n}","import React from 'react';\n\nimport { isArray } from '../../JSUtils';\nimport Plotly from \"plotly.js\";\nimport createPlotlyComponent from \"./factory\";\n\nconst Plot = createPlotlyComponent(Plotly);\n/**\n * React Hook generic Plotly plot which takes data in the following format:\n * [\n    {\n      x: [1, 2, 3],\n      y: [2, 6, 3],\n      type: 'scatter',\n      mode: 'lines+markers',\n      marker: { color: 'red' },\n      name: 'fiq',\n    },\n    { \n      x: [1, 2], \n      y: [2, 5],\n      type: 'line', \n      name: 'lush'\n    },\n  ]\n * @param {Object} props \n */\nexport default function(props) {\n  const { data, width = 250, height = 200, title = \"Plot\",\n    dark, xaxis = {}, yaxis = {},\n    displayModeBar } = props; // Object.assign errs on undefined\n  \n  const axes = { visible: true, color: dark && '#fff'}\n  const sColor = {color: dark && '#fff'};\n\n  if (!data || !isArray(data) || data.length === 0) return null\n  return (\n    <Plot\n      data={data}\n      layout={{\n        width, height, title: {text: title, font: sColor},\n        margin: { t: 30, r: 20, b: 50, l: 30 },\n        paper_bgcolor: dark && '#0000', plot_bgcolor: dark && '#0000',\n        xaxis: Object.assign(axes, xaxis), \n        yaxis: Object.assign(sColor, yaxis),\n        legend: {x: 0.35, y: -0.35, orientation: 'h',\n        font: sColor}\n      }}\n      config={{displayModeBar: !displayModeBar && false}}\n    />\n  );\n}","import React, { useState } from 'react';\nimport { Slider } from 'baseui/slider';\n\nimport GenerateUI from '../UI';\nimport { DateTime } from \"luxon\";\nimport { getPropertyValues } from '../../geojsonutils';\nimport { getFirstDateColumnName, xyObjectByProperty } from '../../utils';\nimport { isString } from '../../JSUtils';\nimport GenericPlotly from './GenericPlotly';\n\n\nconst timeSlider = (props = {}) => {\n  const { data, property, dark, title  } = props;\n  // feature array\n  if (!isString(property) || !data || !data.length) return null;\n  const dateColumn = getFirstDateColumnName(data[0].properties);\n  if(!dateColumn) return null;\n  const x = getPropertyValues({features: data}, dateColumn).map(e => new Date(e));\n  const y = getPropertyValues({features: data}, property);\n\n  return (\n    <GenericPlotly dark={dark}\n      title={title || \"Time v \" + property}\n      yaxis={{ showgrid: false }}\n      xaxis={{ showgrid: false }}\n      data={[{\n        // showlegend: false,\n        x, y,\n        mode: 'graph',\n        // marker: { color: TURQUOISE_RANGE[0] }\n      }]} />\n  )\n}\n\n/**\n * Function currently only accepts ISO standard date/datetime.\n * This function generates a \"Year\" slider with option to set\n * year value given int he `option` object.\n * \n * @param {*} options in the form of { data, year, multiVarSelect, onSelectCallback,\n    callback }\n */\nconst yearSlider = (options) => {\n  const { data, year, multiVarSelect, onSelectCallback,\n    callback } = options;\n\n  if (!data || !data.length || !Object.keys(data[0].properties)) return null\n  const yearColumn = getFirstDateColumnName(data[0].properties)\n  // TODO: check every value before proceeding\n  if (!DateTime.fromISO(data[0].properties[yearColumn]).isValid) return null\n\n  const years = [... new Set(getPropertyValues({ features: data }, yearColumn)\n    // returned 2009-01-02, convert to 2009\n    .map(e => DateTime.fromISO(e).year).sort())];\n\n  if (years.length < 2) return null\n\n  return <GenerateUI\n    title={\n      <h5>Year(s): {year ? year :\n        (years[0] + \" - \" + years[years.length - 1])}\n        {year &&\n          <i style={{ fontSize: '2rem' }} className=\"fa fa-trash\"\n            onClick={() => {\n              delete multiVarSelect[yearColumn];\n              typeof (onSelectCallback) === 'function' &&\n                onSelectCallback(Object.keys(multiVarSelect).length === 0 ?\n                  { what: '' } : { what: 'multi', selected: multiVarSelect });\n              callback({\n                year: \"\",\n                multiVarSelect\n              });\n            }} />}\n      </h5>}\n    sublist={years}\n    suggested=\"slider\"\n    onChange={(value) => {\n      // the kye is one of `date` or `YEAR`\n      // keep it the same in delete\n      multiVarSelect[yearColumn] = new Set([value + \"\"]);\n      callback({\n        year: value + \"\",\n        multiVarSelect\n      });\n      typeof (onSelectCallback) === 'function' &&\n        onSelectCallback({ selected: multiVarSelect, what: 'multi' });\n    }} />;\n}\n\nexport {\n  timeSlider,\n  yearSlider,\n}","import React from 'react';\nimport {\n  XYPlot, XAxis, YAxis, HorizontalRectSeries,\n  DiscreteColorLegend\n} from 'react-vis';\nimport { format } from 'd3-format';\n\nimport { isStringDate, propertyCountByProperty } from '../../geojsonutils';\nimport { isArray } from '../../JSUtils';\nimport { PLOT_W, TURQUOISE_RANGE } from '../../Constants';\nimport { xyObjectByProperty, humanize } from '../../utils';\nimport { scaleSequential } from 'd3-scale';\n\nimport GenericPlotly from './GenericPlotly';\n\nconst W = PLOT_W,\n  COLOR_F = 'rgb(18, 147, 154)',\n  COLOR_M = 'rgb(239, 93, 40)';\n\n\nconst plotByPropertyByDate = (data, property, dark) => {\n  if (!data || !isArray(data) || !data.length || !property) return null;\n\n  const plot_data_multi = arrayOfYearAndProperty(data, property);\n\n  if(!plot_data_multi) return null;\n\n  return (\n    <GenericPlotly dark={dark}\n      yaxis={{ showgrid: false }}\n      xaxis={{ showgrid: false }}\n      data={\n        plot_data_multi.map((r, i) => ({\n          mode: 'lines',\n          showlegend: false,\n          x: r.map(e => e.x)\n            // TODO: more robust sorting of dates\n            .sort((a, b) => new Date(a) - new Date(b)),\n          y: r.map(e => e.y),\n          name: [\"Male\", \"Female\", \"Total\"][i],\n          marker: { color: scaleSequential(TURQUOISE_RANGE)(i / plot_data_multi.length) }\n        }))} title=\"Sex of Casualty\" />\n  )\n}\n/**\n * \n * @param {Object} data \n * @param {String} property \n * @param {Boolean} dark \n */\nconst plotByProperty = (data, property, dark) => {\n  if (!data || !isArray(data) || !data.length) return null;\n\n  const data_by_prop = data[0].properties.hasOwnProperty(property) &&\n    xyObjectByProperty(data, property)\n  \n  if(!data_by_prop) return null;\n\n  return (\n    <GenericPlotly dark={dark}\n      yaxis={{ showgrid: false }}\n      xaxis={{ showgrid: false }}\n      data={[{\n        // showlegend: false,\n        x: data_by_prop.map(e => +(e.x)),\n        y: data_by_prop.map(e => +(e.y)),\n        marker: { color: TURQUOISE_RANGE[0] }\n      }]}\n      title={humanize(property)} />\n  )\n}\n\n/**\n * Generate a population pyramid using Rect-vis series objects.\n * Series objects are formatted as {left,right,bottom, top}\n * \n * Currently semi hardcoded for sex_of_casualty and date from\n * STATS19 dataset\n * \n * @param {Object} options \n */\nconst popPyramidPlot = (options) => {\n  if (!options || !options.data || !options.data[0] ||\n    !options.data[0].properties.date ||\n    !options.data[0].properties.sex_of_casualty) return;\n  const mf = propertyCountByProperty(options.data, \"sex_of_casualty\", \"date\");\n  const mf_array_male = [];\n  const mf_array_female = [];\n  if (Object.keys(mf).length === 1) return;\n\n  mf && Object.keys(mf).forEach((y, i) => {\n    mf_array_male.push({\n      x: 0,\n      x0: +(mf[y].Male),\n      y: i === 0 ? 0 : i,\n      y0: i + 1,\n      color: \"#428BCA\"\n    })\n  })\n  mf && Object.keys(mf).forEach((y, i) => {\n    mf_array_female.push({\n      x: 0,\n      x0: -1 * (+(mf[y].Female)),\n      y: i === 0 ? 0 : i,\n      y0: i + 1\n    })\n  })\n  return (\n    <>\n      <XYPlot\n        margin={{ left: options.margin || 60 }} // default is 40\n        height={options.plotStyle && options.plotStyle.height || W}\n        width={options.plotStyle && options.plotStyle.width || W} >\n        <HorizontalRectSeries\n          color={COLOR_F}\n          stroke='black'\n          data={mf_array_female} />\n        <HorizontalRectSeries\n          color={COLOR_M}\n          stroke='black'\n          data={mf_array_male} />\n\n        <YAxis\n          tickSize={0}\n          tickFormat={v => v === 0 ? 2009 : v - 2 + 2009}\n          style={{\n            line: { strokeWidth: 0 },\n            text: { fill: options.dark ? '#fff' : '#000', fontWeight: 400 }\n          }}\n        />\n        {/* left={(W / 2) - 10} */}\n        <XAxis\n          tickSize={0}\n          tickFormat={v => format(\".2s\")(v < 0 ? -1 * v : v)}\n          style={{\n            line: { strokeWidth: 0 },\n            text: { fill: options.dark ? '#fff' : '#000', fontWeight: 400 }\n          }}\n        />\n      </XYPlot>\n      <DiscreteColorLegend\n        orientation=\"horizontal\" width={W}\n        items={[\n          { title: \"Male\", color: COLOR_M },\n          { title: \"Female\", color: COLOR_F }\n        ]}\n      />\n    </>\n  )\n}\n\n/**\n * Function looks at date for two properties and generates a react-vis\n * ready two-dimensional array of the two propties. Currently it is semi-hard-coded.\n * \n * A function like this is meant to make converting geojson data object given,\n * to charting library ready format to be consumed.\n * \n * @param {Object} data \n * @param {String} column \n */\nconst arrayOfYearAndProperty = (data, column) => {\n  const notEmpty = isArray(data) && data.length > 0 && column;\n  const plot_data_multi = [[], [], []];\n\n  if (notEmpty) {\n    // return 0 for 1 item array or generate random\n    const n = data.length === 1 ? 0 :\n      Math.floor((Math.random() * (data.length - 1)) + 1);\n    const timeCols = Object.keys(data[n].properties)\n      .filter(each => isStringDate(data[n].properties[each]));\n    if (timeCols.length > 0) {\n      const mf = propertyCountByProperty(data, column, timeCols[0]);\n      // mf === 2009: {Male: 3295, Female: 2294}\n      mf && Object.keys(mf).length > 1 && // more than one years\n        Object.keys(mf)\n          .forEach(y => { // year\n            if (y && mf[y].Male && mf[y].Female) {\n              plot_data_multi[0]\n                .push({\n                  x: y,\n                  y: mf[y].Male\n                });\n              plot_data_multi[1]\n                .push({\n                  x: y,\n                  y: mf[y].Female\n                });\n              plot_data_multi[2]\n                .push({\n                  x: y,\n                  y: mf[y].Male + mf[y].Female\n                })\n            }\n          });\n    }\n  }\n  if(!plot_data_multi[0].length) return null\n  return plot_data_multi;\n}\n\nexport {\n  arrayOfYearAndProperty,\n  plotByPropertyByDate,\n  plotByProperty,\n  popPyramidPlot\n}","import React from 'react';\nimport { ascending, quantile } from 'd3-array';\n\nimport { isNumber } from '../../JSUtils';\nimport { convertRange } from '../../utils';\n\nimport './style.css'\n\nexport default (props) => {\n  const { className, data, marginLeft, marginTop,\n    lineAttrs, plotStyle } = props;\n  if (!data || !Array.isArray(data) || data.length === 0) return null;\n  let isNumeric = true;\n  data.forEach(e => {\n    if (!isNumber(e)) {\n      isNumeric = false\n    }\n  });\n  if (!isNumeric) return null;\n  // proceed\n  const W = 100, H = (plotStyle && plotStyle.height) || 100, limit = 5;\n  // Compute summary statistics used for the box:\n  let data_sorted = data.sort(ascending)\n  data_sorted = data_sorted.map(e => convertRange(e, {\n    oldMax: data_sorted[data_sorted.length - 1],\n    oldMin: data_sorted[0],\n    newMax: W - 5, newMin: 5\n  }))\n\n  let q1 = +quantile(data_sorted, .25).toFixed(2)\n  let median = +quantile(data_sorted, .5).toFixed(2)\n  let q3 = +quantile(data_sorted, .75).toFixed(2)\n  let interQuantileRange = +(q3 - q1).toFixed(2)\n  // https://www.purplemath.com/modules/boxwhisk3.htm\n  let min = +(q1 - 1.5 * interQuantileRange).toFixed(2)\n  let max = +(q1 + 1.5 * interQuantileRange).toFixed(2)\n  const outliers = data_sorted.filter(e => e > max || e < min)\n\n  // rescale variables according to screensize\n  const Y = 5, yHeight = 60, yMiddle = Y + (yHeight / 2);\n\n  // show less on scale depending on settings\n  let scale = data;\n  if (data.length > limit) {\n    scale = [];\n    data.forEach((item, idx) => {\n      let d = Math.floor(data.length / limit);\n      if (d === 1) d = 2;\n      if ((idx % d) === 0) {\n        let l = Math.floor(item);\n        if (l > 1000) l = (l / 1000).toFixed(1) + \"k\"\n        scale.push(l)\n      }\n    })\n  }\n\n  return (\n    <div style={{\n      width: '100%',\n      height: H,\n      position: 'relative',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center'\n    }}>\n      <div style={{\n        width: '100%',\n        height: '100%',\n        maxWidth: '600px',\n      }}>\n        <svg width='100%' height='100%'>\n          <g style={{\n            stroke: (plotStyle && plotStyle.lineColor) || 'rgb(18, 147, 154)'\n          }}>\n            <line\n              x1={min + \"%\"}\n              x2={q1 + \"%\"}\n              y1={yMiddle + \"%\"}\n              y2={yMiddle + \"%\"}\n              {...lineAttrs}\n            />\n            {/* bottom line */}\n            <line\n              style={{ strokeWidth: 1 }}\n              x1={min + \"%\"} x2={min + \"%\"} y1={Y + \"%\"}\n              y2={(Y + yHeight) + \"%\"} {...lineAttrs} />\n            <line\n              x1={max + \"%\"}\n              x2={q3 + \"%\"}\n              y1={yMiddle + \"%\"}\n              y2={yMiddle + \"%\"}\n              {...lineAttrs}\n            />\n            {/* top line */}\n            <line\n              style={{ strokeWidth: 1 }}\n              x1={max + \"%\"} x2={max + \"%\"} y1={Y + \"%\"}\n              y2={(Y + yHeight) + \"%\"} {...lineAttrs} />\n            <rect\n              x={q1 + \"%\"}\n              width={interQuantileRange + \"%\"}\n              y={Y + \"%\"}\n              height={yHeight + \"%\"}\n              fill={(plotStyle && plotStyle.fillColor) || 'rgb(18, 147, 154)'}\n              stroke=\"black 0.5px\"\n            />\n            {/* median */}\n            <line\n              style={{ stroke: 'black', strokeWidth: 1 }}\n              x1={median + \"%\"} x2={median + \"%\"}\n              y1={Y + \"%\"} y2={(Y + yHeight) + \"%\"} {...lineAttrs} />\n            {/* outliers */}\n            {\n              outliers.map((e, i) => <circle\n                key={e + \"-\" + i}\n                r=\"5\"\n                // avoid placing first on top/bottom line\n                cx={(e > max ? e + 2 : e - 2) + \"%\"}\n                cy={yMiddle + \"%\"}\n                style={{\n                  fill: 'none',\n                  opacity: 1\n                }}></circle>)\n            }\n            {/* axis */}\n            {/* <line \n            x1={'5%'} y1=\"80%\" x2={(W - 10) + \"%\"} y2={'80%'} /> */}\n            {\n              scale && scale.map((v, i) => {\n                const x1 = i * (W / scale.length);\n                return (\n                  <g key={x1 + \"-\" + i}>\n                    {/* <line \n                    style={{ stroke: 'white', strokeWidth: 0.5 }}\n                  x1={x1 + \"%\"} y1={\"80%\"} x2={x1} y2={'82%'} /> */}\n                    <text x={(x1 + 2) + \"%\"} y={\"85%\"}\n                      // transform=\"rotate(10)\" style={{textAnchor:\"end\"}}\n                      className=\"d3-axis-labels\">{v}</text>\n                  </g>\n                )\n              })\n            }\n          </g>\n        </svg>\n      </div>\n    </div>\n  )\n}","import React from 'react';\nimport MultiSelect from '../MultiSelect';\nimport { getLayerProps } from './settingsUtils';\nimport {\n  humanize\n} from '../../utils';\nimport { Slider } from 'baseui/slider';\nimport { Checkbox } from \"baseui/checkbox\";\nimport { isString } from '../../JSUtils';\nimport { Accordion, Panel } from 'baseui/accordion';\n\n\n/**\n * One idea is to do the same done in Variables. When a set of \n * properties need to be assigned different types of primitive\n * values, one drop down could lead to each property shown \n * along with suitable UI to assign value to.\n * \n * Current version shows all properties with their suitable UI\n * (using baseui) so that each value can be set.\n * \n * @param {*} props \n * @returns \n */\nexport default function LayerSettings(props) {\n  const { layerName, columnNames, onLayerOptionsCallback } = props;\n  const [options, setOptions] = React.useState(getLayerProps(layerName));\n  const [values, setValues] = React.useState({});\n\n  React.useEffect(() => {\n    if (!props.layerName) return\n    const lp = getLayerProps(props.layerName);\n    if (!lp) return\n    setOptions(lp)\n  }, [props.layerName])\n\n  return (\n    <Accordion>\n      <Panel\n        title={\"Settings: \" + layerName}>\n        {\n          Object.keys(options).map(key => {\n            const v = options[key].type;\n            return isString(v) && getUIForKey(v, key);\n          })\n        }\n      </Panel>\n    </Accordion>\n  )\n\n  function getUIForKey(v, key) {\n    if (key === 'class') return null\n    switch (v) {\n      case 'number':\n        return <>\n          {key}\n          <Slider\n            // raw number is kept in values \n            value={(values[key] && [values[key]]) || [options[key].default]}\n            min={options[key].min}\n            max={options[key].max}\n            step={options[key].step}\n            onChange={({ value }) => {\n              const newValues = { ...values, [key]: value[0] };\n              setValues(newValues)\n              typeof onLayerOptionsCallback === 'function' &&\n                onLayerOptionsCallback(newValues)\n            }} />\n        </>;\n      case 'boolean':\n        return <Checkbox\n          checked={values.hasOwnProperty(key) ?\n            values[key] : options[key].value}\n          onChange={() => {\n            const newValues = { ...values, [key]: !values[key] }\n            setValues(newValues)\n            typeof onLayerOptionsCallback === 'function' &&\n              onLayerOptionsCallback(newValues)\n          }}\n        >{humanize(key)}</Checkbox>;\n      default:\n        return <>\n          {key}\n          <MultiSelect\n            title={humanize(key)}\n            single={true}\n            values={columnNames.map(e => ({ id: humanize(e), value: e }))}\n            onSelectCallback={(selected) => {\n              const newValues = {\n                ...values,\n                //is it resetting a key?\n                [key]: (d) => selected.length ?\n                  d.properties[selected[0].value] : options[key].default\n              }\n              setValues(newValues)\n              typeof onLayerOptionsCallback === 'function' &&\n                onLayerOptionsCallback(newValues)\n\n            }} />\n        </>;\n    }\n  }\n}","import React from 'react';\nimport {\n  Tabs, Tab, FormGroup, InputGroup,\n  FormControl, Glyphicon, Checkbox\n} from 'react-bootstrap';\nimport { Button, KIND, SIZE } from 'baseui/button';\n\nimport './DeckSidebar.css';\nimport DataInput from '../DataInput';\nimport MapboxBaseLayers from '../MapboxBaseLayers';\nimport {\n  xyObjectByProperty, percentDiv,\n  searchNominatom, firstLastNCharacters,\n  humanize, getMainMessage\n} from '../../utils';\nimport { VerticalBarSeries } from 'react-vis';\nimport Variables from '../Variables';\nimport RBAlert from '../RBAlert';\nimport { propertyCount } from '../../geojsonutils';\nimport ColorPicker from '../ColourPicker';\nimport Modal from '../Modal';\nimport DataTable from '../Table';\n\nimport { yearSlider } from '../showcases/Widgets';\nimport {\n  popPyramidPlot, plotByPropertyByDate,\n  plotByProperty\n} from '../showcases/plots';\nimport SeriesPlot from '../showcases/SeriesPlot';\nimport { isEmptyOrSpaces } from '../../JSUtils';\nimport MultiSelect from '../MultiSelect';\nimport AddVIS from '../AddVIS';\nimport Boxplot from '../boxplot/Boxplot';\nimport LayerSettings from '../settings/LayerSettings';\nimport { LAYERS } from '../settings/settingsUtils'\n\nexport default class DeckSidebar extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      radius: 100,\n      elevation: 4,\n      year: \"\", // required to reset state\n      reset: false,\n      multiVarSelect: {},\n      barChartVariable: \"road_type\",\n      datasetName: props.datasetName\n    }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    const { data, alert, loading, layerStyle } = this.props;\n    const { elevation, radius, reset, year,\n      barChartVariable } = this.state;\n    // avoid rerender as directly operating on document.get* \n    // does not look neat. Keeping it React way.\n    if (reset !== nextState.reset ||\n      year !== nextState.year ||\n      elevation !== nextState.elevation ||\n      radius !== nextState.radius ||\n      alert !== nextProps.alert ||\n      loading !== nextProps.loading ||\n      layerStyle !== nextProps.layerStyle ||\n      barChartVariable !== nextState.barChartVariable) return true;\n    //TODO:  a more functional way is needed        \n    if (data && nextProps && nextProps.data &&\n      data.length === nextProps.data.length) {\n      return false\n    }\n    return true;\n  }\n\n  /**\n   * Render the sidebar empty if no data is loaded.\n   * Partly because we like to load from a URL.\n   */\n  render() {\n    const { year, subsetBoundsChange, multiVarSelect, \n      barChartVariable, datasetName } = this.state;\n    const { onLayerOptionsCallback,\n      onSelectCallback, data, colourCallback, unfilteredData,\n      toggleSubsetBoundsChange, urlCallback, alert, layerStyle,\n      onlocationChange, column, dark, toggleOpen, toggleHexPlot\n    } = this.props;\n\n    const notEmpty = data && data.length > 1;\n\n    // TODO: more comprehensive method needed\n    // last reg is \"\" string which is undefined\n    const withRadius = !layerStyle ||\n      new RegExp(\"grid|sgrid|hex|scatter\", \"i\").test(layerStyle);\n\n    const severity_data = propertyCount(data, \"accident_severity\");\n    let columnDomain = [];\n    let columnData = notEmpty ?\n      xyObjectByProperty(data, column || barChartVariable) : [];\n\n    const columnNames = notEmpty && Object.keys(data[0].properties)\n      .filter(p => !isEmptyOrSpaces(p));\n\n    const columnPlot = {\n      data: columnData,\n      opacity: 1,\n      stroke: 'rgb(72, 87, 104)',\n      fill: 'rgb(18, 147, 154)',\n    }\n\n    const resetState = (urlOrName, button) => {\n      this.setState({\n        reset: !button,\n        year: \"\",\n        multiVarSelect: {},\n        barChartVariable: \"road_type\",\n        datasetName: urlOrName || datasetName\n      })\n    }\n\n    return (\n      <>\n        <div\n          style={{\n            color: dark ? \"white\" : \"black\",\n            background: dark ? \"#242730\" : \"white\"\n          }}\n          className=\"side-panel\">\n          <RBAlert alert={alert} />\n          {this._headerComponent(dark,\n            <><h2>{getMainMessage(data, unfilteredData)}</h2>\n              {notEmpty &&\n                <h6 className=\"truncate\">\n                  dataset: {firstLastNCharacters(datasetName, 15)}\n                </h6>\n              }</>)\n          }\n          <div>\n            <DataInput\n              toggleOpen={() => typeof toggleOpen === 'function' && toggleOpen()}\n              urlCallback={(url, geojson, name) => {\n                resetState(url || name);\n                typeof (urlCallback) === 'function'\n                  && urlCallback(url, geojson);\n                typeof (toggleOpen) === 'function' && toggleOpen()\n              }\n              } />\n            {notEmpty &&\n              <Modal\n                toggleOpen={() => typeof toggleOpen === 'function' && toggleOpen()}\n                component={<DataTable data={data} />} />}\n            {\n              this.state.reset &&\n              <Button\n                kind={KIND.secondary} size={SIZE.compact}\n                onClick={() => {\n                  resetState(undefined, true);\n                  typeof (urlCallback) === 'function'\n                    && urlCallback();\n                  typeof (this.props.showLegend) === 'function' &&\n                    this.props.showLegend(false);\n                }}>Reset</Button>\n            }\n          </div>\n          <div className=\"side-panel-body\">\n            <div className=\"side-panel-body-content\">\n              {/* range of two values slider is not native html */\n                yearSlider({\n                  data: unfilteredData, year, multiVarSelect,\n                  // for callback we get { year: \"\",multiVarSelect }\n                  onSelectCallback, callback: (changes) => this.setState(changes)\n                })\n              }\n              <br />\n              {/* TODO: generate this declaritively too */}\n              {\n                severity_data && severity_data.map(each =>\n                  percentDiv(each.x, 100 * each.y / data.length, () => {\n                    if (multiVarSelect && multiVarSelect['accident_severity'] &&\n                      multiVarSelect['accident_severity'].has(each.x)) {\n                      delete multiVarSelect['accident_severity'];\n                    } else {\n                      multiVarSelect['accident_severity'] = new Set([each.x]);\n                      this.setState({ multiVarSelect })\n                    }\n                    onSelectCallback &&\n                      onSelectCallback(Object.keys(multiVarSelect).length === 0 ?\n                        { what: '' } : { what: 'multi', selected: multiVarSelect })\n                  }, dark))\n              }\n              <hr style={{ clear: 'both' }} />\n              {columnDomain.length > 1 &&\n                <Boxplot data={columnDomain} />}\n\n              <Tabs defaultActiveKey={\"1\"} id=\"main-tabs\">\n                <Tab eventKey=\"1\" title={\n                  <i style={{ fontSize: '2rem' }}\n                    className=\"fa fa-info\" />\n                }>\n                  {/* pick a column and vis type */}\n                  {this._panel(dark,\n                    <AddVIS data={data} dark={dark} plotStyle={{ width: 270, margin: 10 }} />\n                  )}\n                  {/* distribution example */}\n                  {plotByProperty(data, \"age_of_casualty\", dark)}\n                  {plotByPropertyByDate(data, \"sex_of_casualty\", dark)}\n                  {notEmpty && columnNames.length > 0 &&\n                    layerStyle !== \"grid\" &&\n                    <>\n                      <h6>Column for layer:</h6>\n                      <MultiSelect\n                        title=\"Choose Column\"\n                        single={true}\n                        value={column && { id: humanize(column), value: column }}\n                        values={\n                          columnNames.map(e =>\n                            ({ id: humanize(e), value: e }))\n                        }\n                        onSelectCallback={(selected) => {\n                          // array of seingle {id: , value: } object\n                          const newBarChartVar = (selected && selected[0]) ?\n                            selected[0].value : barChartVariable;\n                          this.setState({\n                            barChartVariable: newBarChartVar\n                          });\n                          typeof onSelectCallback === 'function' &&\n                            onSelectCallback({\n                              what: 'column', selected: newBarChartVar\n                            });\n                        }}\n                      />\n                    </>\n                  }\n                  {<SeriesPlot\n                    dark={dark}\n                    data={columnPlot.data}\n                    type={VerticalBarSeries}\n                    onValueClick={(datapoint) => {\n                      // convert back to string\n                      multiVarSelect[column ||\n                        barChartVariable] = new Set([datapoint.x + \"\"]);\n                      this.setState({ multiVarSelect })\n                      onSelectCallback &&\n                        onSelectCallback({ what: 'multi', selected: multiVarSelect })\n                    }}\n                    onDragSelected={(datapoints) => {\n                      multiVarSelect[column ||\n                        barChartVariable] = new Set(datapoints.map(e => e + \"\"));\n                      this.setState({ multiVarSelect })\n                      onSelectCallback &&\n                        onSelectCallback({ what: 'multi', selected: multiVarSelect })\n                    }}\n                    plotStyle={{ marginBottom: 100 }} noYAxis={true}\n\n                  />}\n                  {popPyramidPlot({ data, dark: dark })}\n                </Tab>\n                <Tab eventKey=\"2\" title={\n                  <i style={{ fontSize: '2rem' }}\n                    className=\"fa fa-sliders\" />\n                }>\n                  {notEmpty &&\n                    this._headerComponent(dark,\n                      <ColorPicker colourCallback={(color) =>\n                        typeof colourCallback === 'function' &&\n                        colourCallback(color)} />\n                    )\n                  }\n                  {notEmpty &&\n                    this._panel(dark,\n                      <>\n                        <h6>Deck Layer:</h6>\n                        <MultiSelect\n                          title=\"Choose Layer\"\n                          single={true}\n                          values={\n                            // TODO:filter based on data\n                            LAYERS.map(e =>\n                              ({ id: humanize(e), value: e }))\n                          }\n                          onSelectCallback={(selected) => {\n                            // array of seingle {id: , value: } object\n                            if (selected && selected[0]) {\n                              const ls = selected[0].value;\n                              this.setState({ layerStyle: ls });\n                              typeof onSelectCallback === 'function' &&\n                                onSelectCallback({\n                                  what: 'layerStyle', selected: ls\n                                });\n                            }\n                          }}\n                        />\n                        <LayerSettings\n                          dark={dark}\n                          layerName={layerStyle}\n                          columnNames={columnNames}\n                          onLayerOptionsCallback={(layerOptions) => {\n                            typeof (onLayerOptionsCallback) === 'function' &&\n                              onLayerOptionsCallback({ ...layerOptions })\n                          }} />\n                      </>)\n                  }\n                  {\n                    this._headerComponent(dark,\n                      <>\n                        Map Styles\n                        <br />\n                        <MapboxBaseLayers\n                          dark={dark}\n                          onSelectCallback={(selected) =>\n                            onSelectCallback &&\n                            onSelectCallback({\n                              selected: selected,\n                              what: 'mapstyle'\n                            })\n                          }\n                        />\n                      </>)\n                  }\n                  {notEmpty && withRadius &&\n                    <Checkbox\n                      onChange={() => toggleHexPlot && toggleHexPlot()}\n                    >Hex Plot</Checkbox>\n                  }\n                  {notEmpty &&\n                    <Checkbox\n                      onChange={() => {\n                        this.setState({ subsetBoundsChange: !subsetBoundsChange })\n                        if (toggleSubsetBoundsChange && typeof (toggleSubsetBoundsChange) === 'function') {\n                          toggleSubsetBoundsChange(!subsetBoundsChange) //starts with false\n                        }\n                      }}\n                    >Subset by map boundary</Checkbox>\n                  }\n                </Tab>\n                <Tab eventKey=\"3\" title={\n                  <i style={{ fontSize: '2rem' }}\n                    className=\"fa fa-filter\" >{\n                      multiVarSelect && Object.keys(multiVarSelect).length ?\n                        Object.keys(multiVarSelect).length : \"\"\n                    }</i>\n                }>\n                  {\n                    unfilteredData && unfilteredData.length > 0 &&\n                    this._headerComponent(dark, <Variables\n                      dark={dark}\n                      multiVarSelect={multiVarSelect}\n                      onSelectCallback={(mvs) => {\n                        typeof (onSelectCallback) === 'function' &&\n                          onSelectCallback(\n                            Object.keys(mvs).length === 0 ?\n                              { what: '' } : { what: 'multi', selected: mvs })\n                        this.setState({ multiVarSelect: mvs })\n                      }}\n                      unfilteredData={unfilteredData} />\n                    )\n                  }\n                </Tab>\n              </Tabs>\n            </div>\n            <div className=\"space\"></div>\n            {this._headerComponent(dark, \"Vis: \" + (layerStyle || \"None\"))}\n            <form className=\"search-form\" onSubmit={(e) => {\n              e.preventDefault();\n              searchNominatom(this.state.search, (json) => {\n                let bbox = json && json.length > 0 && json[0].boundingbox;\n                bbox = bbox && bbox.map(num => +(num))\n                typeof onlocationChange === 'function' && bbox &&\n                  onlocationChange({\n                    bbox: bbox,\n                    lon: +(json[0].lon), lat: +(json[0].lat)\n                  })\n              })\n            }}>\n              <FormGroup>\n                <InputGroup>\n                  <FormControl\n                    style={{\n                      background: dark ? '#242730' : 'white',\n                      color: dark ? 'white' : 'black'\n                    }}\n                    onChange={(e) => this.setState({ search: e.target.value })}\n                    placeholder=\"fly to...\" type=\"text\" />\n                  <InputGroup.Addon\n                    style={{\n                      background: dark ? '#242730' : 'white',\n                      color: dark ? 'white' : 'black'\n                    }}>\n                    <Glyphicon glyph=\"search\" />\n                  </InputGroup.Addon>\n                </InputGroup>\n              </FormGroup>\n            </form>\n          </div>\n        </div>\n      </>\n    )\n  }\n\n  _headerComponent(dark, content) {\n    return (\n      <div\n        style={{\n          marginTop: 2,\n          background: dark ? '#29323C' : '#eee'\n        }}\n        className=\"side-pane-header\">\n        {content}\n      </div>)\n  }\n\n  _panel(dark, content) {\n    return (\n      <div\n        style={{\n          borderColor: dark ? '#29323C' : '#eee'\n        }}\n        className=\"side-panel-group\">\n        {content}\n      </div>)\n  }\n}\n\n","import React, { Component } from 'react';\nimport { Slider } from 'baseui/slider';\nimport { XYPlot, XAxis, YAxis, HexbinSeries, Hint } from 'react-vis';\n\nexport default class HexHeatmap extends Component {\n  state = {\n    hoveredNode: null,\n    radius: 10,\n    offset: 0,\n  };\n  render() {\n    const { data, options } = this.props;\n    const { radius, hoveredNode } = this.state;\n    if(!data || !data.length) return null\n    return (\n      <div className=\"centered-and-flexed\" style={{color:'#fff'}}>\n        <Slider\n            value={[this.state.radius]}\n            min={5}\n            max={50}\n            step={5}\n            onChange={({ value }) => {\n              this.setState({ radius: value[0] });\n              // typeof (onChange) === 'function' && onChange(value[0])\n            }}\n          />\n          {\"Radius (pixels)\"}\n        <XYPlot\n          margin={{ left: 10, bottom: 10 }}\n          height={options &&\n            options.plotStyle && options.plotStyle.height || 350}\n          width={options &&\n            options.plotStyle && options.plotStyle.width || 350}\n          onMouseLeave={() => this.setState({ hoveredNode: null })}\n        >\n          <HexbinSeries\n            animation\n            className=\"hexbin-example\"\n            style={{\n              stroke: '#125C77',\n              strokeLinejoin: 'round'\n            }}\n            // onValueMouseOver={d => this.setState({ hoveredNode: d })}\n            colorRange={['orange', 'cyan']}\n            radius={radius}\n            data={data}\n          />\n          {options && !options.noXAxis && \n          <XAxis tickLabelAngle={-45} style={{\n            text: { fill: '#fff', fontWeight: 400 }\n          }} />}\n          {options && !options.noYAxis && \n          <YAxis tickLabelAngle={-45} style={{\n            text: { fill: '#fff', fontWeight: 400 }\n          }} />}\n          {/* {hoveredNode && (\n            <Hint\n              style={{ background: '#fff', position: 'relative' }}\n              xType=\"literal\"\n              yType=\"literal\"\n              getX={d => 50}\n              getY={d => 50}\n              value={{\n                x: hoveredNode.x,\n                y: hoveredNode.y,\n                value: hoveredNode.length\n              }}\n            />\n          )} */}\n        </XYPlot>\n      </div>\n    );\n  }\n}\n","import React, { useState, useEffect } from 'react';\nimport HexbinSeries from '../showcases/HexbinSeries';\n\nimport { coordsAsXY } from '../../geojsonutils';\n\nexport default (props) => {\n  // const [value, setValue] = useState([]);\n  const [open, setOpen] = useState(props.isMobile === false);\n  useEffect(() => {\n    // if props.open change to false is\n    // the only time it should react to it\n    if (props.open === true) return;\n    setOpen(props.open);\n  }, [props.open])\n\n  const { data } = props;\n  const notEmpty = data && data.length > 1;\n\n  if (notEmpty && data[0].geometry.type.toUpperCase() === 'POINT') {\n    return (\n      <div\n        style={{\n          marginRight: !open ? -350 : 0\n        }}\n        className=\"right-panel-container\">\n        <div\n          className=\"close-button\"\n          onClick={() => setOpen(!open)}\n          style={{ color: 'white' }}>\n          <i\n            style={{\n              //bottom and just outside the div\n              marginLeft: -16,\n              bottom: 0,\n              position: 'absolute',\n              backgroundColor: '#242730',\n              fontSize: '2rem', color: 'white !important'\n            }}\n            className={open ? \"fa fa-arrow-circle-right\" :\n              \"fa fa-arrow-circle-left\"} />\n        </div>\n        <div className=\"right-side-panel\">\n          {notEmpty &&\n            <HexbinSeries\n              data={coordsAsXY({ features: data })}\n              options={{ noXAxis: true, noYAxis: true }} />}\n        </div>\n      </div>\n    );\n  } else {\n    return null\n  }\n\n};","import React, { useState } from \"react\";\n\nimport DeckSidebar from \"./DeckSidebar\";\nimport HexPlot from './HexPlot';\n\n/**\n * The idea of this component is to avoid \n * rerender in the main component, everytime\n * open/close is executed. \n * \n * It could add further states to save main component rerendering \n * if need be.\n * \n */\nexport default (props) => {\n  const [open, setOpen] = useState(!props.isMobile);\n  const [hex, setHex] = useState(false);\n\n  // console.log(hex);\n\n  return (\n    <div className=\"side-panel-container\"\n      style={{ marginLeft: open ? 0 : '-320px' }}>\n      <DeckSidebar {...props}\n        // Note: \n        // *****************************\n        // Hooks is strange see this\n        // https://stackoverflow.com/a/54069332/2332101\n        // *****************************\n        toggleOpen={() => setOpen(o => !o)}   // o is current open\n        toggleHexPlot={() => setHex(h => !h)} // h is current hex\n      />\n      {hex &&\n        <HexPlot open={open} isMobile={props.isMobile}\n          data={props.data} />}\n      <div\n        className=\"close-button\"\n        onClick={() => setOpen(!open)}\n        style={{ color: 'white' }}>\n        <div style={{ backgroundColor: '#242730' }}>\n          <i\n            style={{ fontSize: '2rem', color: 'white !important' }}\n            className={open ? \"fa fa-arrow-circle-left\" :\n              \"fa fa-arrow-circle-right\"} />\n        </div>\n      </div>\n    </div>\n  );\n}","// https://github.com/ReactTraining/react-router/blob/master/FAQ.md#how-do-i-access-the-history-object-outside-of-components\n// history.js\nimport { createBrowserHistory } from 'history'\nexport default createBrowserHistory()","import React from 'react';\nimport { Table } from 'baseui/table';\nimport { humanize } from '../utils';\nimport { getPropertyValues, propertyCountByProperty } from '../geojsonutils';\nimport Plot from './showcases/GenericPlotly';\nimport { scaleSequential } from 'd3-scale';\nimport { TURQUOISE_RANGE } from '../Constants';\n\nconst WIDTH = 220;\nconst BAR_HEIGHT = 80;\n\nexport default class Tooltip extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      isMobile: props.isMobile,\n    };\n    this._listPropsAndValues = this._listPropsAndValues.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this._handleWindowSizeChange.bind(this));\n  }\n\n  // make sure to remove the listener\n  // when the component is not mounted anymore\n  componentWillUnmount() {\n    window.removeEventListener('resize', this._handleWindowSizeChange.bind(this));\n  }\n\n  _handleWindowSizeChange () {\n    this.forceUpdate()\n  };\n\n  /**\n   * hoverdObject can be of two types so far:\n   * 1. collections of points with `.points` property\n   * 2. properties of `.type === 'Feature'`.\n   */\n  render() {\n    const { topx, topy, hoveredObject,\n      column1 = \"accident_severity\", column2 = \"date\" } = this.props;\n    const { isMobile } = this.state;\n    // console.log(topx, topy);\n    // console.log(hoveredObject)\n\n    if (!hoveredObject) return null;\n\n    const type_feature = hoveredObject.type &&\n      hoveredObject.type === 'Feature';\n    const cluster = hoveredObject && hoveredObject.cluster\n    // {cluster: true, cluster_id: 8, point_count: 54, \n    // point_count_abbreviated: 54}\n\n    let severity_data_separate = [];\n    if (!type_feature && !cluster) {\n      // separate the severity into [[],[]] arrays\n      const severity_keys = column1 && getPropertyValues(\n        { features: hoveredObject.points.map(e => e.source) }, \n        column1);\n      const severity_by_year = column1 && column2 &&\n        propertyCountByProperty(\n          hoveredObject.points.map(e => e.source), \n          column1, column2);\n      //{2009: {Slight: 1}, 2010: {Slight: 3}, 2012: {Slight: 4}, \n      // 2013: {Slight: 3}, 2014: {Serious: 1}, 2015: {Slight: 6}, \n      // 2016: {Serious: 1, Slight: 2}, 2017: {Slight: 1}}\n      // now turn it into [{},{}]\n\n      severity_keys && severity_keys.forEach((name, i) => {\n        Object.keys(severity_by_year).forEach(y => {\n          if (y && severity_by_year[y][name]) {\n            if (!severity_data_separate[i]) {\n              severity_data_separate[i] = {\n                x: [], y: [], name: name,\n                marker: { color: scaleSequential(TURQUOISE_RANGE)(i / severity_keys.length) }\n              };\n            }\n            // 2016: {Serious: 1, Slight: 2}\n            severity_data_separate[i].x.push(y);\n            severity_data_separate[i].y.push(severity_by_year[y][name]);\n          }\n        })\n      })\n      severity_data_separate.map(e => {\n        if (e.x.length > 1) {\n          e.mode = 'lines'\n        }\n      })\n    }\n\n    const w = window.innerWidth;\n    const y = window.innerHeight;\n    const n_topy = isMobile ? 10 :\n      topy + (WIDTH + BAR_HEIGHT) > y ? topy - WIDTH : topy;\n    const n_left = isMobile ? 10 :\n      topx + WIDTH > w ? topx - WIDTH : topx;\n    const tooltip =\n      <div\n        className=\"xyz\" style={{\n          top: topy + (WIDTH + BAR_HEIGHT) > y ? n_topy : topy,\n          left: topx + WIDTH > w ? n_left : topx\n        }}>\n        <div>\n          <b>Total: {cluster ? hoveredObject.point_count :\n            type_feature ? 1 : hoveredObject.points.length}</b>\n        </div>\n        <div>\n          {\n            // Simple logic, if points and less two points or less,\n            // or not poingts, hard to expect React-vis generating plot.\n            // so list the values of the non-point or list both points.\n            !cluster && (type_feature || hoveredObject.points.length <= 2) ?\n            this._listPropsAndValues(hoveredObject) :\n            <Plot\n              title={`${humanize(column1)} by ${humanize(column2)}`}\n              width={WIDTH}\n              data={severity_data_separate}\n              dark={true}\n              xaxis={{ tickformat: 'd', showgrid: false }}\n              yaxis={{ showgrid: false }} />\n          }\n        </div>\n      </div >\n    return (tooltip)\n  }\n\n  _listPropsAndValues(hoveredObject, all = false, n = 6) {\n    if(!hoveredObject.properties || \n      (hoveredObject.points && (!hoveredObject.points || \n       !hoveredObject.points[0].properties))) return null\n\n    let DATA = []\n    const props = hoveredObject.properties;\n    if (props) {\n      const keys = Object.keys(props)\n      DATA = keys\n        .slice(1, all ? keys.length : n)\n        .map(p => {\n          return ([humanize(p), props[p]])\n        })\n    } else { // two points passed go through first one\n      const keys = Object.keys(hoveredObject.points[0].properties);\n      DATA = keys\n        .slice(1, all ? keys.length : n) // miss accident_index\n        .map(p => {\n          let points = [\n            humanize(p),\n            hoveredObject.points[0].properties[p],\n          ]\n          if (hoveredObject.points[1]) {\n            points.push(hoveredObject.points[1].properties[p])\n          }\n          return (points)\n        })\n    }\n    return <Table style={{ maxWidth: '320px' }}\n      columns={\n        hoveredObject.points &&\n          hoveredObject.points.length === 2 ?\n          ['Property', 'Value p1', 'Value p2'] : ['Property', 'Value']\n      } data={DATA} />\n\n  }\n}","/**\n * Main entry to the application.\n * \n * The crucial bits are:\n * \n     this.state = {\n      data,            <= main data holding param\n      layers: [],      <= mapgl layers object\n      initialViewState:<= deckgl/mapgl initial state object\n      legend: false    <= map legend to avoid rerender.\n    }\n * and\n * DeckSidebarContainer which holds DeckSidebar object itself.\n * \n * Main funcitons:\n * _generateLayer which is the main/factory of filtering state\n * of the map area of the application.\n * \n */\nimport React from 'react';\nimport DeckGL from 'deck.gl';\nimport MapGL, { NavigationControl, FlyToInterpolator } from 'react-map-gl';\nimport centroid from '@turf/centroid';\nimport bbox from '@turf/bbox';\nimport _ from 'underscore';\n\nimport {\n  fetchData, generateDeckLayer, suggestDeckLayer,\n  getParamsFromSearch, getBbx, isMobile, colorScale, OSMTILES,\n  colorRanges, generateDomain, setGeojsonProps,\n  convertRange, getMin, getMax, isURL, getFirstDateColumnName, \n  generateLegend, humanize, colorRangeNamesToInterpolate, getColorArray,\n} from './utils';\nimport Constants, { LIGHT_SETTINGS } from './Constants';\nimport DeckSidebarContainer from\n  './components/decksidebar/DeckSidebarContainer';\nimport history from './history';\n\nimport './App.css';\nimport Tooltip from './components/Tooltip';\nimport { sfType } from './geojsonutils';\nimport { DateTime } from 'luxon';\nimport { throttle } from 'lodash';\n\nconst URL = (process.env.NODE_ENV === 'development' ? \n  Constants.DEV_URL : Constants.PRD_URL);\nconst defualtURL = process.env.REACT_APP_DEFAULT_URL || (URL + \"/api/stats19\");\n\n// Set your mapbox access token here\nconst MAPBOX_ACCESS_TOKEN = process.env.REACT_APP_MAPBOX_ACCESS_TOKEN;\n\nconst gradient = {\n  height: '200px',\n  // TODO: which browsers?\n  backgroundColor: 'red', /* For browsers that do not support gradients */\n  /* Standard syntax (must be last) */\n  backgroundImage: 'linear-gradient(to top, red , yellow)' \n}\n\nexport default class Welcome extends React.Component {\n  constructor(props) {\n    super(props)\n    const init = Constants.DECKGL_INIT\n    const param = getParamsFromSearch(props.location.search);\n    if (param) {\n      //lat=53.814&lng=-1.534&zoom=11.05&bea=0&pit=55&alt=1.5\n      Object.keys(param).forEach(key => {\n        Object.keys(init).forEach(iKey => {\n          if (iKey.startsWith(key)) {\n            init[key] = param[key]\n          }\n        })\n      })\n    }\n\n    this.state = {\n      loading: true,\n      layers: [],\n      backgroundImage: gradient.backgroundImage,\n      layerOptions: { \n        radius: Constants.RADIUS,\n        elevation: Constants.ELEVATION,\n        cellSize: Constants.RADIUS,\n      },\n      mapStyle: MAPBOX_ACCESS_TOKEN ? (\"mapbox://styles/mapbox/\" +\n        (props.dark ? \"dark\" : \"streets\") + \"-v9\") : OSMTILES,\n      initialViewState: init,\n      subsetBoundsChange: false,\n      lastViewPortChange: new Date(),\n      colorName: 'default',\n      iconLimit: Constants.ICONLIMIT,\n      legend: false,\n      multiVarSelect: {},\n      width: window.innerWidth, height: window.innerHeight,\n      tooltipColumns: {column1: \"accident_severity\" , column2: \"date\"},\n      geographyURL: process.env.REACT_APP_GEOGRAPHY_URL || null,\n      geographyColumn: process.env.REACT_APP_GEOGRAPHY_COLUMN_NAME || null,\n      column: process.env.REACT_APP_COLUMN_NAME || null\n    }\n    this._generateLayer = this._generateLayer.bind(this)\n    this._renderTooltip = this._renderTooltip.bind(this);\n    this._fetchAndUpdateState = this._fetchAndUpdateState.bind(this);\n    this._fitViewport = this._fitViewport.bind(this);\n    this._initWithGeojson = this._initWithGeojson.bind(this);\n    this._updateURL = this._updateURL.bind(this);\n    // TODO: can let user change the 300\n    this._throttleUR = throttle((v) => this._updateURL(v), 300)\n  }\n\n  componentDidMount() {\n    this._fetchAndUpdateState()\n    window.addEventListener('resize', this._resize);\n  }\n  componentWillUnmount() {\n    window.removeEventListener('resize', this._resize);\n  }\n\n  /**\n   * Main function to fetch data and update state.\n   * \n   * @param {String} aURL to use if not default `/api/stats19` is used.\n   * @param {Object} customError to use in case of urlCallback object/urls.\n   */\n  _fetchAndUpdateState(aURL, customError) {\n    if (aURL && !isURL(aURL)) return;\n    if (customError && typeof (customError) !== 'object') return;\n    const fullURL = aURL ? aURL : defualtURL;\n\n    // geojson URL must be consistent just like defaultURL\n    // geographyURL\n    fetchData(fullURL, (data, error) => {\n      const { geographyURL } = this.state;\n      if(isURL(geographyURL)) {\n        // it will always show geojson empty as column is not set\n        fetchData(geographyURL, (geojson, geoErr) => {\n          if(!geoErr) {\n            this.setState({\n              loading: false,\n              geography: geojson,\n              data: data,\n              alert: customError || null\n            });\n            this._fitViewport(geojson);\n            this._generateLayer();\n          } else {\n            this.setState({\n              loading: false,\n              alert: { content: 'Could not reach: ' + geographyURL }\n            });\n          }\n        })\n      } else {\n        this._initWithGeojson(error, data, customError, fullURL);\n      }\n    })\n  }\n\n  /**\n   * Helper function to simply set state with geojson `data` and \n   * name the source with `fullURL`. The other params are error management.\n   * \n   * @param {*} error any error to avoid setting data param\n   * @param {*} data geojson valid object to use throughout eAtlas\n   * @param {*} customError any custom error similar to `error` used by \n   * `this.state.alert`\n   * @param {*} fullURL here used as naming source of data and shown on header\n   */\n  _initWithGeojson(error, data, customError, fullURL) {\n    if (!error) {\n      this.setState({\n        loading: false,\n        data: data,\n        alert: customError || null\n      });\n      this._fitViewport(data);\n      this._generateLayer();\n    } else {\n      this.setState({\n        loading: false,\n        alert: { content: 'Could not reach: ' + fullURL }\n      });\n      //network error?\n    }\n  }\n\n  /**\n   * The main function generating DeckGL layer and customizing mapbox styles.\n   * The reason why state is not updated down in <DeckSidebarContainer />\n   * is to optimise the number of setState or equivalent React hooks.\n   * \n   * @param {*} values includes\n   * @param {Object} filter multivariate filter of properties\n   * @param {String} cn short for colorName passed from callback\n   * @param {Object} layerOptions\n   */\n  _generateLayer(values = {}) {\n    const { layerOptions = {}, filter, cn } = values;\n\n    if (filter && filter.what === 'mapstyle') {\n      const newStyle = \"mapbox://styles/mapbox/\" + filter.selected + \"-v9\";\n      this.setState({\n        mapStyle: !MAPBOX_ACCESS_TOKEN ? OSMTILES :\n          filter && filter.what === 'mapstyle' ? filter.selected === \"No map\" ?\n          Constants.BLANKSTYLE : newStyle : this.state.mapStyle,\n      })\n      return;\n    }\n    let data = this.state.data && this.state.data.features\n    // data or geography and add column data\n    if (!data) return;\n\n    let column = (filter && filter.what === 'column' && filter.selected) ||\n      this.state.column;\n    const columnNameOrIndex = column || 1;\n\n    const { colorName, iconLimit, geography, geographyColumn,\n      multiVarSelect } = this.state;\n    if (filter && filter.what === \"%\") {\n      data = data.slice(0, filter.selected / 100 * data.length)\n    }\n    // to optimize the search keep state as the source of truth\n    if (this.state.coords) {\n      data = this.state.filtered;\n    }\n\n    //if resetting a value\n    const filterValues = filter && filter.what === 'multi' ||\n      Object.keys(multiVarSelect).length;\n    const filterCoords = filter && filter.what === 'coords';\n    const selected = filter && filter.selected || multiVarSelect;\n    if (filterValues || filterCoords) {\n      const yearColumn = getFirstDateColumnName(data[0].properties);\n      data = data.filter(\n        d => {\n          if (filterValues) {\n            // go through each selection\n            // selected.var > Set()\n            for (let each of Object.keys(selected)) {\n              const nextValue = each === yearColumn ?\n                DateTime.fromISO(d.properties[each]).year + \"\" : \n                d.properties[each] + \"\"\n              // each from selected must be in d.properties\n              // *****************************\n              // compare string to string\n              // *****************************\n              if (!selected[each].has(nextValue)) {\n                return false\n              }\n            }\n          }\n          if (filterCoords) {\n            // coords in \n            if (_.difference(filter.selected || this.state.coords,\n              d.geometry.coordinates.flat()).length !== 0) {\n              return false;\n            }\n          }\n          return (true)\n        }\n      )\n      // critical check\n      if (!data || !data.length) {\n        this.setState({\n          alert: { content: 'Filtering returns no results' }\n        })\n        return\n      };\n    }\n    const geomType = sfType(\n      geography ? geography.features[0] : data[0]\n    ).toLowerCase();\n    // needs to happen as soon as filtering is done\n    // assemble geometry from this.state.geometry if so\n    if (geomType === \"polygon\" || geomType === \"multipolygon\") {\n      // is there a geometry provided?\n      if (geography) {\n        // is geometry equal to or bigger than data provided?\n        if (data.length > geography.features.length) {\n          // for now just be aware\n          //TODO: alert or just stop it?\n        }\n        data = setGeojsonProps(geography, data, geographyColumn)\n        // critical check\n        if (!data || !data.features) {\n          this.setState({\n            alert: { content: 'Is there a matching geography column?' }\n          })\n          return\n        };\n        // it was data.features when this function started\n        data = data.features || data;\n      }\n    }\n    let layerStyle = (filter && filter.what ===\n      'layerStyle' && filter.selected) || this.state.layerStyle || \n      suggestDeckLayer(geography ? geography.features : data);\n    // TODO: incorporate this into suggestDeckLayer\n    if (!new RegExp(\"point\", \"i\").test(geomType)) layerStyle = \"geojson\"\n    const switchToIcon = data.length < iconLimit && !layerStyle && \n    (!filter || filter.what !== 'layerStyle') && geomType === \"point\";\n    if (switchToIcon) layerStyle = 'icon';\n\n    const options = Object.assign({\n      ...this.state.layerOptions,      \n      lightSettings: LIGHT_SETTINGS,\n      colorRange: colorRanges(cn || colorName),\n      getColor: getColorArray(cn || colorName)\n    }, layerOptions);\n    \n    // generate a domain\n    const domain = generateDomain(data, columnNameOrIndex);\n    const getValue = (d) => \n    // initialazied with 1 so +columnNameOrIndex is safe\n    d.properties[+columnNameOrIndex ?\n      Object.keys(d.properties)[columnNameOrIndex] : columnNameOrIndex]\n\n    if (layerStyle === 'heatmap') {\n      options.getPosition = d => d.geometry.coordinates\n      // options.getWeight = d => d.properties[columnNameOrIndex]\n      options.updateTriggers = {\n        // even if nulls\n        getWeight: typeof(options.getWeight) === 'function' &&\n        data.map(d => options.getWeight(d))\n      }\n    }\n    if (geomType === 'linestring') {\n      layerStyle = \"line\"\n      // https://github.com/uber/deck.gl/blob/master/docs/layers/line-layer.md\n      options.getColor = d => [235, 170, 20]\n      options.getPath = d => d.geometry.coordinates\n      options.onClick = (info) => {\n        if (info && info.hasOwnProperty('coordinate')) {\n          if (['path', 'arc', 'line'].includes(this.state.layerStyle) &&\n            info.object.geometry.coordinates) {\n            this._generateLayer({\n              filter: {\n                what: 'coords',\n                selected: info.object.geometry.coordinates[0]\n              }\n            })\n          }\n        }\n      }\n      if (layerStyle === 'line') {\n        // options.getSourceColor = d => \n        // [Math.sqrt(+(d.properties.base)) * 1000, 140, 0]\n        // options.getTargetColor = d => \n        // [Math.sqrt(+(d.properties.hs2)) * 1e13, 140, 0]\n        options.getSourcePosition = d => d.geometry.coordinates[0] // geojson\n        options.getTargetPosition = d => d.geometry.coordinates[1] // geojson\n      }\n      if (+(data[0] && data[0].properties &&\n        data[0].properties[columnNameOrIndex])) {\n        options.getWidth = d => {\n          return this._newRange(data, d, columnNameOrIndex, \n            getMin(domain), getMax(domain));\n        }; // avoid id\n      }\n    }\n    // TODO \n    if (layerStyle === 'scatter') {\n      if (+(data[0] && data[0].properties &&\n        data[0].properties[columnNameOrIndex])) {\n        options.getRadius = d => {\n          return this._newRange(data, d, columnNameOrIndex,\n            getMin(domain), getMax(domain));\n        }\n      }\n    }\n    let newLegend = this.state.legend;\n\n    if (geomType === \"polygon\" || geomType === \"multipolygon\" ||\n      layerStyle === 'geojson') {\n      const fill =  (d) => colorScale(\n        +getValue(d) ? +getValue(d) : getValue(d),\n        domain, 180, cn || this.state.colorName\n      )\n      options.getFillColor = fill;\n\n      options.updateTriggers = {\n        getFillColor: data.map((d) => fill(d))\n      }\n      const isNumeric = +(data[0].properties[\n        +columnNameOrIndex ?\n        Object.keys(data[0].properties)[columnNameOrIndex] : columnNameOrIndex\n      ])\n      if(isNumeric) {\n        newLegend = generateLegend(\n          {\n            domain,\n            title: humanize(column),\n            interpolate: colorRangeNamesToInterpolate(\n              cn || this.state.colorName\n            )\n          }\n        )\n      }\n    }\n    if (layerStyle === 'barvis') {\n      options.getPosition = d => [d.geometry.coordinates[0],\n      d.geometry.coordinates[1], 0]\n      // if (data[0].properties.result) options.getRotationAngle = d =>\n      //   d.properties.result.includes(\"gain from\") ? 45 : 1\n      options.getScale = 20\n      options.updateTriggers = {\n        // TODO: get the functions & spread them\n        getRotationAngle: typeof(options.getRotationAngle) === 'function' &&\n          data.map(d => options.getRotationAngle(d)),\n        getWidth: typeof(options.getWidth) === 'function' &&\n          data.map(d => options.getWidth(d))\n      }\n    }\n    const alayer = generateDeckLayer(\n      layerStyle, data, this._renderTooltip, options\n    )\n\n    this.setState({\n      alert: switchToIcon ? { content: 'Switched to icon mode. ' } : null,\n      loading: false,\n      layerStyle,\n      geomType,\n      tooltip: \"\",\n      filtered: data,\n      layers: [alayer],\n      layerOptions: options,\n      // do not save if not given etc\n      multiVarSelect: filter && filter.what === \"multi\" ?\n        filter.selected : multiVarSelect,\n      road_type: filter && filter.what === 'road_type' ? filter.selected :\n        this.state.road_type,\n      colorName: cn || colorName,\n      column, // all checked\n      coords: filter && filter.what === 'coords' ? filter.selected :\n        this.state.coords,\n      legend: newLegend\n    })\n  }\n\n  _fitViewport(newData, bboxLonLat) {\n    const data = newData || this.state.data;\n    if ((!data || data.length === 0) && !bboxLonLat) return;\n    const bounds = bboxLonLat ?\n      bboxLonLat.bbox : bbox(data)\n    const center = bboxLonLat ? \n    [bboxLonLat.lon, bboxLonLat.lat] : centroid(data).geometry.coordinates;\n\n    this.map.fitBounds(bounds, {padding:'100px'})\n\n    const viewport = {\n      ...this.state.viewport,\n      longitude: center[0],\n      latitude: center[1],\n      transitionDuration: 500,\n      transitionInterpolator: new FlyToInterpolator(),\n      // transitionEasing: d3.easeCubic\n    };\n    this.setState({ viewport })\n  }\n\n  /**\n   * Currently the tooltip focuses on aggregated layer (grid).\n   * \n   * @param {Object} params passed from DeckGL layer. \n   */\n  _renderTooltip(params) {\n    const { x, y, object } = params;\n    const hoveredObject = object;\n    // return\n    if (!hoveredObject) {\n      this.setState({ tooltip: \"\" })\n      return;\n    }\n    this.setState({\n      tooltip:\n        // react did not like x and y props.\n        <Tooltip\n          {...this.state.tooltipColumns}\n          isMobile={isMobile()}\n          topx={x} topy={y} hoveredObject={hoveredObject} />\n    })\n  }\n\n  _updateURL(viewport) {\n    const { latitude, longitude, zoom, bearing, pitch, altitude } = viewport;\n    const { subsetBoundsChange, lastViewPortChange } = this.state;\n\n    //if we do history.replace/push 100 times in less than 30 secs \n    // browser will crash\n    if (new Date() - lastViewPortChange > 1000) {\n      history.push(\n        `/?lat=${latitude.toFixed(3)}` +\n        `&lng=${longitude.toFixed(3)}` +\n        `&zoom=${zoom.toFixed(2)}` +\n        `&bea=${bearing}` +\n        `&pit=${pitch}` +\n        `&alt=${altitude}`\n      )\n      this.setState({ lastViewPortChange: new Date() })\n    }\n    const bounds = this.map && this.map.getBounds()\n    if (bounds && subsetBoundsChange) {\n      const box = getBbx(bounds)\n      const { xmin, ymin, xmax, ymax } = box;\n      fetchData(defualtURL + xmin + \"/\" +\n        ymin + \"/\" + xmax + \"/\" + ymax,\n        (data, error) => {\n          if (!error) {\n            this.setState({\n              data: data.features,\n            })\n            this._generateLayer()\n          } else {\n            //network error?\n          }\n        })\n    }\n\n  }\n\n  render() {\n    const { tooltip, viewport, initialViewState,\n      loading, mapStyle, alert, data, filtered,\n      layerStyle, geomType, legend, coords } = this.state;\n\n    return (\n      <div id=\"html2pdf\">\n        {/* just a little catch to hide the loader \n        when no basemap is presetn */}\n        <div className=\"loader\" style={{\n          zIndex: loading ? 999 : -1,\n          visibility: typeof mapStyle === 'string' &&\n            mapStyle.endsWith(\"No map-v9\") ? 'hidden' : 'visible'\n        }} />\n        <MapGL\n          ref={ref => {\n            // save a reference to the mapboxgl.Map instance\n            this.map = ref && ref.getMap();\n          }}\n          mapStyle={mapStyle}\n          onViewportChange={(viewport) => {\n            this._throttleUR(viewport)\n            this.setState({ viewport })\n          }}\n          height={this.state.height - 54 + 'px'}\n          width={this.state.width + 'px'}\n          //crucial bit below\n          viewState={viewport ? viewport : initialViewState}\n        // mapboxApiAccessToken={MAPBOX_ACCESS_TOKEN}\n        >\n          <div className='mapboxgl-ctrl-top-right' style={{\n            zIndex: 9\n          }}>\n            <NavigationControl\n              {...viewport}\n              onViewportChange={viewport => this.setState({ viewport })}\n            />\n          </div>\n          <DeckGL\n            viewState={viewport ? viewport : initialViewState}\n            initialViewState={initialViewState}\n            layers={this.state.layers}\n            // see docs below, url split for readability\n            // https://deck.gl/#/documentation/developer-guide/\n            // adding-interactivity?\n            // section=using-the-built-in-event-handling\n            onClick={(e) => {\n              if (!e.layer && coords) {\n                this.setState({ coords: null })\n                this._generateLayer()\n              }\n            }}\n          >\n            {tooltip}\n          </DeckGL>\n        </MapGL>\n        <DeckSidebarContainer\n          dark={this.props.dark}\n          layerStyle={layerStyle}\n          isMobile={isMobile()}\n          key=\"decksidebar\"\n          alert={alert}\n          unfilteredData={data && data.features}\n          data={filtered}\n          colourCallback={(colorName) =>\n            this._generateLayer({ cn: colorName })\n          }\n          urlCallback={(url_returned, geojson_returned) => {\n            this.setState({\n              // TODO: full sync in future\n              geography: null,\n              column: null,\n              tooltip: \"\",\n              road_type: \"\",\n              layerOptions: { \n                radius: Constants.RADIUS,\n                elevation: Constants.ELEVATION,\n              },\n              loading: true,\n              coords: null\n            })\n            if (geojson_returned) {\n              // confirm valid geojson\n              try {\n                this.setState({\n                  data: geojson_returned\n                })\n                this._fitViewport(geojson_returned)\n                this._generateLayer()\n              } catch (error) {\n                // load up default\n                this._fetchAndUpdateState(undefined, { content: error.message });\n              }\n            } else {\n              this._fetchAndUpdateState(url_returned);\n            }\n          }}\n          column={this.state.column}\n          onSelectCallback={(selected) => \n            this._generateLayer({ filter: selected })}\n          onLayerOptionsCallback={(layerOptions) => \n            this._generateLayer({ layerOptions })}\n          toggleSubsetBoundsChange={(value) => {\n            this.setState({\n              loading: true,\n              subsetBoundsChange: value\n            })\n            this._fetchAndUpdateState();\n          }}\n          onlocationChange={(bboxLonLat) => {\n            this._fitViewport(undefined, bboxLonLat)\n          }}\n          datasetName={defualtURL}\n        />\n        {\n          legend && (geomType === 'polygon' ||\n            geomType === 'multipolygon') &&\n          <div className=\"right-side-panel mapbox-legend\">\n            {legend}\n          </div>\n        }\n      </div>\n    );\n  }\n  _resize = () => {\n    this.setState({ width: window.innerWidth, height: window.innerHeight });\n  };\n\n  _newRange (data, d, columnNameOrIndex, min, max) {\n    let newMax = 10, newMin = 0.1;\n    if (data.length > 100000) {\n      newMax = 0.5; newMin = 0.005;\n    }\n    const r = convertRange(\n      d.properties[columnNameOrIndex], {\n      oldMin: min, oldMax: max, newMax: newMax, newMin: newMin\n    });\n    return r;\n  }\n}","/**\n * geoplumber R package code.\n */\nimport React, { useState } from 'react';\nimport { Navbar, Nav, NavItem } from 'react-bootstrap';\nimport { Link, withRouter } from 'react-router-dom';\n\nimport { ATILOGO } from '../utils';\n\nconst navs = [\n  {\n    key: 1,\n    to: \"fui\",\n    title: \"DUI\"\n  },\n  {\n    key: 2,\n    to: \"about\",\n    title: \"About\"\n  },\n];\n\nfunction Header(props) {\n  const [dark, setDark] = useState(props.dark)\n  return (\n    <Navbar inverse={dark} collapseOnSelect>\n      <Navbar.Header>\n        <Navbar.Brand>\n          <Link to=\"/\">\n            <svg className=\"logo\" viewBox=\"0 0 1025 428\"\n              version=\"1.1\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n              xlink=\"http://www.w3.org/1999/xlink\">\n              {ATILOGO(dark)}\n            </svg>\n          </Link>\n        </Navbar.Brand>\n        <Navbar.Toggle />\n      </Navbar.Header>\n      <Navbar.Collapse>\n        <Nav>\n          {\n            navs.map((item, i) => {\n              return (\n                <NavItem\n                  key={i}\n                  eventKey={item.key}\n                  onClick={() => props.history.push(item.to)}>\n                  {item.title}\n                </NavItem>\n              )\n            })\n          }\n        </Nav>\n        <Nav pullRight>\n          <NavItem href=\"https://github.com/layik/eAtlas\">\n            <i style={{ fontSize: '1.5em' }} className=\"fa fa-github\"></i>\n          </NavItem>\n        </Nav>\n        <Nav pullRight>\n          <NavItem onClick={() => {\n            typeof props.toggleTheme === 'function' && props.toggleTheme()\n            setDark(!dark)\n          }}>\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n              <g transform=\"matrix( 1 0 0 1 4 1 )\">\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\"\n                  d=\"M15.3999 11C15.7999 10.1 16 9 16 8C16 3.6 12.4 0 8 0C3.6 0 0 3.6 0 8C0 9.1 0.200098 10.1 0.600098 11L2.19995 15L13.8 15L15.3999 11ZM11 22L12.6001 18L3.3999 18L5 22L11 22Z\" fill={\n                    dark ? '#fff' : '#000'\n                  } opacity=\"1\">\n                </path>\n              </g>\n            </svg>\n          </NavItem>\n        </Nav>\n      </Navbar.Collapse>\n    </Navbar >\n  )\n}\n\n// thanks to https://stackoverflow.com/a/42124328/2332101\nexport default withRouter(Header);\n","/**\n * L Hama\n */\nimport React, { Component } from 'react';\nimport marked from \"marked\";\n\n/**\n * Separate the Header and the main content.\n * Up to this point we are still not using SSR\n */\nclass About extends Component {\n  state = { markdown: null }\n  componentDidMount() {\n    const readmePath = \"https://raw.githubusercontent.com/layik/eAtlas/master/README.md\";\n\n    fetch(readmePath)\n      .then(response => {\n        return response.text()\n      })\n      .then(text => {\n        this.setState({\n          markdown: marked(text)\n        })\n      })\n  }\n  render() {\n    const { markdown } = this.state;\n\n    return (\n      <section style={{ background: 'white', padding: '5%' }}>\n        <article dangerouslySetInnerHTML={{ __html: markdown }}></article>\n      </section>\n    )\n  }\n}\n\nexport default About;\n","import { Component } from 'react'\n//https://tylermcginnis.com/react-router-code-splitting/\n//we can further add our laoding spinner here.\nexport default class DynamicImport extends Component {\n  state = {\n    component: null\n  }\n  componentDidMount () {\n    this.props.load()\n      .then((component) => {\n        this.setState(() => ({\n          component: component.default ? component.default : component\n        }))\n      })\n  }\n  render() {\n    return this.props.children(this.state.component)\n  }\n}","/**\n * geoplumber R package code.\n */\nimport React, { useState } from 'react';\nimport { Switch, Route } from 'react-router-dom';\nimport { BrowserRouter } from 'react-router-dom';\nimport { Provider as StyletronProvider } from 'styletron-react';\nimport { BaseProvider, LightTheme, DarkTheme } from 'baseui';\nimport { Client as Styletron } from 'styletron-engine-atomic';\n\nimport Welcome from './Welcome';\nimport Header from './components/Header';\nimport About from './About';\nimport DynamicImport from './components/DynamicImport';\n\nimport './App.css';\n\nconst engine = new Styletron();\n\n/**\n * Code splitting.\n * @param {*} props \n */\nconst DUI = (props) => (\n  <DynamicImport load={() => import('./components/DUI')}>\n    {\n      (Component) => Component === null\n        ? <div className=\"loader\" style={{ zIndex: 999 }} />\n        : <Component {...props} />\n    }\n  </DynamicImport>\n)\n\n/**\n * Separate the Header and the main content.\n * Up to this point we are still not using SSR\n */\nfunction App() {\n    const [dark, setDark] = useState(true)\n    \n    return (\n      <BrowserRouter basename={process.env.PUBLIC_URL}>\n      <main style={{\n        background: dark ? '#242730' : 'white',\n        margin: 'auto', color: dark ? '#a3a5a8' : 'black'\n      }}>\n        <Header dark={dark}\n        toggleTheme={() => setDark(!dark)}/>\n        <StyletronProvider value={engine}>\n          <BaseProvider theme={dark ? DarkTheme : LightTheme}>\n            <Switch>\n              <Route exact path=\"/\" component={(props) => <Welcome \n              {...props}\n              dark={dark}\n              />} />\n              <Route exact path=\"/fui\" component={(props) => <DUI \n              {...props}\n              dark={dark}\n              />} />\n              <Route exact path=\"/about\" component={About} />\n            </Switch>\n          </BaseProvider>\n        </StyletronProvider>\n      </main>\n      </BrowserRouter>\n    )\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","/**\n * geoplumber R package code.\n */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n// brief about serviceworkers from CRA\n// https://stackoverflow.com/a/49314454/11101153\nimport { unregister } from './registerServiceWorker';\n\n/**\n * Separating index.js and App.js:\n * 1. doing above like launch configs here\n * 2. keep App.js clear for React application.\n */\nReactDOM.render(<App />, document.getElementById('root'));\n\nunregister();\n","import {Layer, project32, picking} from '@deck.gl/core';\nimport GL from '@luma.gl/constants';\nimport {Model, Geometry} from '@luma.gl/core';\n\nconst vs = `\n  attribute vec3 positions;\n  attribute vec3 instancePositions;\n  attribute vec3 instancePositions64Low;\n  attribute float instanceRadius;\n  attribute vec4 instanceColors;\n  attribute float instanceScale;\n  attribute float instanceRotationAngle;\n  attribute float instanceWidth;\n  // for onHover to work must\n  // delcare instancePickingColors here and assign it to\n  // geometry.pickingColor\n  // and then register DECKGL_FILTER_COLOR hook in\n  // fragment shader\n  attribute vec3 instancePickingColors;\n\n  varying vec4 vColor;\n  varying vec2 vPosition;\n\n  vec2 rotate_by_angle(vec2 vertex, float angle) {\n    float angle_radian = angle * PI / 180.0;\n    float cos_angle = cos(angle_radian);\n    float sin_angle = sin(angle_radian);\n    mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n    return rotationMatrix * vertex;\n  }\n\n  void main(void) {\n    geometry.pickingColor = instancePickingColors;\n\n    vec3 offsetCommon = positions * project_size(instanceRadius);\n    offsetCommon = vec3(rotate_by_angle(offsetCommon.xy, instanceRotationAngle), 0);\n    offsetCommon.x = offsetCommon.x * instanceWidth;\n    // width first\n    offsetCommon = offsetCommon * instanceScale;\n    \n    vec3 positionCommon = project_position(instancePositions, instancePositions64Low);\n    // missx: So in your shader, positionCommon is the anchor position on the map. \n    // offsetCommon is the local coordinate relative to the anchor\n    // You want to leave the anchor alone and rotate the offset\n\n    gl_Position = project_common_position_to_clipspace(vec4(positionCommon + offsetCommon, 1.0));\n\n    vPosition = positions.xy;\n    vColor = instanceColors;\n    DECKGL_FILTER_COLOR(vColor, geometry);\n\n  }`;\n\nconst fs = `\n  precision highp float;\n\n  uniform float smoothRadius;\n\n  varying vec4 vColor;\n  varying vec2 vPosition;\n\n  void main(void) {    \n    float distToCenter = length(vPosition);\n\n    if (distToCenter > 1.0) {\n      discard;\n    }\n\n    float alpha = smoothstep(1.0, 1.0 - smoothRadius, distToCenter);\n    gl_FragColor = vec4(vColor.rgb, vColor.a * alpha);\n    DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n  }`;\nconst defaultProps = {\n  // Center of each circle, in [longitude, latitude, (z)]\n  getPosition: {type: 'accessor', value: x => x.position},\n  // Radius of each circle, in meters\n  getRadius: {type: 'accessor', value: 30},\n  // Color of each circle, in [R, G, B, (A)]\n  getColor: {type: 'accessor', value: [0, 0, 0, 255]},\n  // Amount to soften the edges\n  smoothRadius: {type: 'number', min: 0, value: 0.5},\n  // Amount to scale bottom of arrow\n  getScale: {type: 'accessor', value: 1},\n  // Amount to rotate line with\n  getRotationAngle: {type: 'accessor', value: 1},\n  // Amount to thicken the line with\n  getWidth: {type: 'accessor', value: 1},\n};\n\nexport default class BarLayer extends Layer {\n  // getPickingInfo(params) {\n  //   const info = super.getPickingInfo(params);\n  //   const {index} = info;\n  //   const {data} = this.props;\n\n  //   if (data[0] && data[0].__source) {\n  //     // data is wrapped\n  //     info.object = data.find(d => d.__source.index === index);\n  //   }\n  //   // console.log(info);\n    \n  //   return info;\n  // }\n  \n  getShaders() {\n    return super.getShaders({vs, fs, modules: [project32, picking]});\n  }\n\n  initializeState() {\n    this.getAttributeManager().addInstanced({\n      instancePositions: {\n        size: 3,\n        type: GL.DOUBLE,\n        accessor: 'getPosition'\n      },\n      instanceRadius: {\n        size: 1,\n        accessor: 'getRadius',\n        defaultValue: 1\n      },\n      instanceColors: {\n        size: 4,\n        type: GL.UNSIGNED_BYTE,\n        accessor: 'getColor',\n        defaultValue: [1, 0, 0, 255]\n      },\n      smoothRadius: {\n        size: 1,\n        normalized: true,\n        type: GL.UNSIGNED_BYTE,\n        accessor: 'smoothRadius',\n        defaultValue: [1, 0, 0, 255]\n      },\n      instanceScale: {\n        size: 1,\n        accessor: 'getScale',\n        defaultValue: 1\n      },\n      instanceRotationAngle: {\n        size: 1,\n        accessor: 'getRotationAngle',\n        defaultValue: 1\n      },\n      instanceWidth: {\n        size: 1,\n        accessor: 'getWidth',\n        defaultValue: 1\n      }\n    })\n  }\n  updateState({props, oldProps, changeFlags}) {\n    super.updateState({props, oldProps, changeFlags});\n    \n    if (changeFlags.extensionsChanged) {\n      const {gl} = this.context;\n      if (this.state.model) {\n        this.state.model.delete();\n      }\n      this.setState({model: this._getModel(gl)});\n    }\n  }\n\n  draw({uniforms}) {\n    this.state.model\n      .setUniforms(uniforms)\n      .setUniforms({\n        smoothRadius: this.props.smoothRadius\n      })\n      .draw();    \n  }\n\n  _getModel(gl) {\n    const positions = [\n      -.1, -1, \n      0.1, -1,\n      -.1, 1,\n      -.1, 1,\n      0.1, 1,\n      0.1, -1,\n    ];\n    return new Model(\n      gl,\n      Object.assign(this.getShaders(), {\n        id: this.props.id,\n        geometry: new Geometry({\n          drawMode: GL.TRIANGLE_STRIP,\n          vertexCount: 6,\n          attributes: {\n            positions: {size: 2, value: new Float32Array(positions)}\n          }\n        }),\n        isInstanced: true\n      })\n    );\n  }\n}\n\nBarLayer.layerName = 'BarLayer';\nBarLayer.defaultProps = defaultProps;","import {\n  ScatterplotLayer, HexagonLayer, GeoJsonLayer,\n  ScreenGridLayer, GridLayer, LineLayer,\n  HeatmapLayer, TextLayer, ArcLayer, PathLayer\n} from 'deck.gl';\nimport IconClusterLayer from '../../icon-cluster-layer';\nimport BarLayer from '../customlayers/BarLayer'\nimport { isString } from '../../JSUtils';\n\nconst addOptionsToObject = (opt, obj) => {\n  Object.keys(opt).forEach(key => {\n    obj[key] = opt[key]\n  })\n  return obj\n}\n\nconst makeObject = (type, min, max, def, step) => {\n  return ({ type, min, max, default: def, step })\n}\n\nconst options = {\n  pickable: { type: 'boolean', value: true },\n  extruded: { type: 'boolean', value: true },\n}\nconst layers = {};\n\nconst hexObject = {\n  class: { value: HexagonLayer, type: 'class' },\n  extruded: { type: 'boolean', value: true },\n  // key: [type, min, max, step, default]\n  radius: makeObject('number', 50, 1000, 100, 50),\n  elevationScale: makeObject('number', 1, 8, 1, 2),\n  getPosition(d) { return d.geometry.coordinates},\n  // opacity: ['number', 0, 1, 0.1, 0.3]\n}\nlayers['hex'] = addOptionsToObject(options, hexObject)\nconst scatterObj = {\n  class: { value: ScatterplotLayer, type: 'class' },\n  opacity: makeObject('number', 0, 1, 0.8, 0.1),\n  getRadius: makeObject('number', 10, 1000, 30, 10),\n  radiusScale: makeObject('number', 0, 1, 0.8, 0.1),\n  radiusMinPixels: makeObject('number', 1, 10, 1, 1),\n  radiusMaxPixels: makeObject('number', 1, 100, 100, 5),\n}\nlayers['scatterplot'] = addOptionsToObject(options, scatterObj)\nconst geojsonObject = {\n  class: { value: GeoJsonLayer, type: 'class' },\n  stroked: { type: 'boolean', value: false },\n  filled: { type: 'boolean', value: true },\n  lineWidthScale: makeObject('number', 20, 100, 20, 5),\n  lineWidthMinPixels: makeObject('number', 2, 20, 2, 2),\n  // getFillColor: [160, 160, 180, 200],\n  // getLineColor: [255, 160, 180, 200],\n  getRadius: makeObject('number', 10, 1000, 30, 10),\n  getLineWidth: makeObject('number', 1, 10, 1, 1),\n  getElevation: makeObject('number', 30, 100, 30, 10),\n  // getElevation: f => Math.sqrt(f.properties.valuePerSqm) * 10,\n  // getFillColor: f => COLOR_RANGE(f.properties.growth),\n}\nlayers['geojson'] = addOptionsToObject(options, geojsonObject)\nconst iconObject = {\n  class: { value: IconClusterLayer, type: 'class' },\n  // iconAtlas: atlas,\n  // iconMapping: mapping,\n  // sizeScale: makeObject('number'),\n  // getPosition: d => d.geometry.coordinates,\n  wrapLongitude: { type: 'boolean', value: false },\n  // getIcon: d => 'marker-1',\n  // getSize: d => 5,\n  // getColor: d => [Math.sqrt(d.exits), 140, 0],\n}\nlayers['icon'] = addOptionsToObject(options, iconObject)\nconst sgridObject = {\n  class: { value: ScreenGridLayer, type: 'class' },\n  // getPosition: d => d.geometry.coordinates,\n  // getWeight: d => d.properties.weight,\n  cellSizePixels: makeObject('number', 50, 100, 50, 5),\n  // colorRange,\n  // gpuAggregation,\n}\nlayers['sgrid'] = addOptionsToObject(options, sgridObject)\nconst gridObject = {\n  class: { value: GridLayer, type: 'class' },\n  cellSize: makeObject('number', 100, 5000, 100, 50),\n  elevationScale: makeObject('number', 4, 10, 4, 2),\n}\nlayers['grid'] = addOptionsToObject(options, gridObject)\nconst lineObject = {\n  class: { value: LineLayer, type: 'class' },\n  getPosition: function(d) { return d.geometry.coordinates},\n  /**\n   * TODO\n   */\n  // getSourcePosition: d => d.geometry.coordinates[0],\n  // getTargetPosition: d => d.geometry.coordinates[1],\n}\nlayers['line'] =  addOptionsToObject(options, lineObject)\nconst arcObject = {\n  class: { value: ArcLayer, type: 'class' },\n  // getSourcePosition: d => d.geometry.coordinates[0],\n  // getTargetPosition: d => d.geometry.coordinates[1],\n}\nlayers['arc'] = addOptionsToObject(options, arcObject)\nconst pathObject = {\n  class: { value: PathLayer, type: 'class' },\n}\nlayers['path'] = addOptionsToObject(options, pathObject)\nconst heatObject = {\n  class: { value: HeatmapLayer, type: 'class' },\n  getWeight: { type: 'column', value: 'number', default: 1}\n}\nlayers['heatmap'] = addOptionsToObject(options, heatObject);\nconst textObject = {\n  class: { value: TextLayer, type: 'class' },\n}\nlayers[\"text\"] = addOptionsToObject(options, textObject);\nconst barvisObject = {\n  class: { value: BarLayer, type: 'class' },\n  getRotationAngle: { type: 'column', value: 'number', default: 1},\n  getWidth: { type: 'column', value: 'number', default: 1}\n}\nlayers[\"barvis\"] = addOptionsToObject(options, barvisObject);\n\n/**\n * Frozen object to keep the properties intact.\n * \n * @param {String} name \n * @returns \n */\nconst getLayerProps = (name) => {\n  if (!isString(name)) return null\n  return Object.freeze(layers[name])\n}\n\nconst LAYERS = Object.keys(layers)\n\nexport {\n  getLayerProps,\n  LAYERS\n}\n","import {CompositeLayer} from '@deck.gl/core';\nimport {IconLayer} from '@deck.gl/layers';\nimport Supercluster from 'supercluster';\n\nfunction getIconName(size) {\n  if (size === 0) {\n    return '';\n  }\n  if (size < 10) {\n    return `marker-${size}`;\n  }\n  if (size < 100) {\n    return `marker-${Math.floor(size / 10)}0`;\n  }\n  return 'marker-100';\n}\n\nfunction getIconSize(size) {\n  return Math.min(100, size) / 100 + 1;\n}\n\nexport default class IconClusterLayer extends CompositeLayer {\n  shouldUpdateState({changeFlags}) {\n    return changeFlags.somethingChanged;\n  }\n\n  updateState({props, oldProps, changeFlags}) {\n    const rebuildIndex = changeFlags.dataChanged || props.sizeScale !== oldProps.sizeScale;\n\n    if (rebuildIndex) {\n      const index = new Supercluster({maxZoom: 16, radius: props.sizeScale});\n      index.load(\n        props.data.map(d => ({\n          geometry: {coordinates: props.getPosition(d)},\n          properties: d\n        }))\n      );\n      this.setState({index});\n    }\n\n    const z = Math.floor(this.context.viewport.zoom);\n    if (rebuildIndex || z !== this.state.z) {\n      this.setState({\n        data: this.state.index.getClusters([-180, -85, 180, 85], z),\n        z\n      });\n    }\n  }\n\n  getPickingInfo({info, mode}) {\n    const pickedObject = info.object && info.object.properties;\n    if (pickedObject) {\n      if (pickedObject.cluster && mode !== 'hover') {\n        info.objects = this.state.index\n          .getLeaves(pickedObject.cluster_id, 25)\n          .map(f => f.properties);\n      }\n      info.object = pickedObject;\n    }\n    return info;\n  }\n\n  renderLayers() {\n    const {data} = this.state;\n    const {iconAtlas, iconMapping, sizeScale} = this.props;\n\n    return new IconLayer(\n      this.getSubLayerProps({\n        id: 'icon',\n        data,\n        iconAtlas,\n        iconMapping,\n        sizeScale,\n        getPosition: d => d.geometry.coordinates,\n        getIcon: d => getIconName(d.properties.cluster ? d.properties.point_count : 1),\n        getSize: d => getIconSize(d.properties.cluster ? d.properties.point_count : 1)\n      })\n    );\n  }\n}\n","/*\nUtility Functions\n\nthanks https://github.com/realm/github-gantt/blob/master/utilities.js\n\n*/\nvar isString = function(x) {\n    return x !== null && x !== undefined && x.constructor === String\n}\n\nvar isNumber = function(x) {\n    return x !== null && x !== undefined && x.constructor === Number\n}\n\nvar isBoolean = function(x) {\n    return x !== null && x !== undefined && x.constructor === Boolean\n}\n\nvar isObject = function(x) {\n    return x !== null && x !== undefined && x.constructor === Object\n}\n\nvar isArray = function(x) {\n    return x !== null && x !== undefined && x.constructor === Array\n}\n\nvar isDate = function(d) {\n  if ( Object.prototype.toString.call(d) === \"[object Date]\" ) {\n    if ( isNaN( d.getTime() ) ) {\n      return false;\n    }\n    else {\n      return true;\n    }\n  }\n  else {\n    return false;\n  }\n}\n\n// var isRealmObject = function(x) {\n//     return x !== null && x !== undefined && x.constructor === Realm.Object\n// }\n\n// var isRealmList = function(x) {\n//     return x !== null && x !== undefined && x.constructor === Realm.List\n// }\n\nvar sanitizeFloat = function(number) {\n    if (isNumber(number)) {\n        return number;\n    }\n    else if (isString(number)) {\n        let n = parseFloat(number);\n        if (isNaN(n)) {\n          return null;\n        }\n        else {\n          return n;\n        }\n    }\n    else {\n        return null;\n    }\n}\n\nvar sanitizeInt = function(number) {\n    if (isNumber(number)) {\n        return number;\n    }\n    else if (isString(number)) {\n        return parseInt(number);\n    }\n    else {\n        return null;\n    }\n}\n\nvar sanitizeString = function(string) {\n    if (isString(string)) {\n        return string;\n    }\n    else if (isNumber(string)) {\n        return string.toString();\n    }\n    else {\n        return null;\n    }\n}\n\nvar sanitizeStringNonNull = function(string) {\n    if (isString(string)) {\n        return string;\n    }\n    else if (isNumber(string)) {\n        return string.toString();\n    }\n    else {\n        return \"\";\n    }\n}\n\nvar sanitizeBool = function(bool) {\n    if (isBoolean(bool)) {\n        return bool;\n    }\n    else if (isNumber(bool)) {\n        return Boolean(bool);\n    }\n    else {\n        return null;\n    }\n}\n\nfunction isEmptyOrSpaces(str){\n  return str === null || str.match(/^ *$/) !== null;\n}\n\nfunction randomToNumber (n = 0) {\n  return Math.floor(Math.random() * n)\n}\n\nexports.randomToNumber = randomToNumber;\nexports.isBoolean = isBoolean;\nexports.isString = isString;\nexports.isNumber = isNumber;\nexports.isObject = isObject;\nexports.isArray = isArray;\nexports.isDate = isDate;\n// exports.isRealmObject = isRealmObject;\n// exports.isRealmList = isRealmList;\nexports.sanitizeFloat = sanitizeFloat;\nexports.sanitizeInt = sanitizeInt;\nexports.sanitizeString = sanitizeString;\nexports.sanitizeStringNonNull = sanitizeStringNonNull;\nexports.sanitizeBool = sanitizeBool;\nexports.isEmptyOrSpaces = isEmptyOrSpaces;","import React, { useState } from 'react';\nimport {\n  makeWidthFlexible,\n  XYPlot, XAxis, YAxis, MarkSeries,\n  Hint\n} from 'react-vis';\nimport { format } from 'd3-format';\n\nimport { shortenName } from '../../utils';\nimport { PLOT_W } from '../../Constants';\n\nconst W = PLOT_W;\nconst FlexibleXYPlot = makeWidthFlexible(XYPlot);\n\nexport default function SeriesPlot(options) {\n  const [hint, setHint] = useState();\n  const [x, setX] = useState(null);\n  const [y, setY] = useState(null);\n  const [x1, setX1] = useState(null);\n  const [y1, setY1] = useState(null);\n  const [rect, setRect] = useState(null);\n  const [selected, setSelected] = useState([]);\n\n  const ReactSeries = options.type;\n  if (!ReactSeries) return null;\n  const limit = 10;\n\n  const data = options.type !== MarkSeries && !options.noLimit &&\n    options.data && options.data.length > limit ? options.data.slice(0, limit)\n    : options.data;\n\n  const { plotStyle, title, noXAxis, noYAxis,\n    onValueClick, onDragSelected } = options;\n\n  if (!data || !data.length) return null\n\n  const dataWithColor = data.map((d, i) => ({\n    ...d,\n    // if selected return 0 which is:\n    // ['rgb(239, 93, 40)', 'rgb(18, 147, 154)']\n    color: data.length === selected.length ? 0 : Number(!selected.includes(i))\n  }));\n  return (\n    // https://github.com/uber/react-vis/issues/584#issuecomment-401693372\n    <div className=\"unselectable\"\n      style={{ position: 'relative' }}\n      onMouseDown={(e) => {\n        if (!x && !y) {\n          setX(e.clientX); setY(e.clientY)\n        }\n      }}\n      onMouseMove={(e) => {\n        if (x && y) {\n          const newX = e.clientX; const newY = e.clientY;\n          setX1(newX); setY1(newY);\n          setRect(\n            <div style={{\n              position: 'fixed',\n              left: x > newX ? newX : x, top: y > y1 ? newY : y,\n              width: Math.abs(newX - x), height: Math.abs(newY - y),\n              backgroundColor: 'gray', opacity: 0.2\n            }} />\n          )\n        }\n      }}\n      onMouseUp={(e) => {\n        setX(null); setY(null); setX1(null); setY1(null);\n        setRect(null);\n        if (rect) {\n          typeof (onDragSelected) === 'function' &&\n            onDragSelected(selected.map(e =>\n              dataWithColor[e] && dataWithColor[e].x))\n        }\n        setSelected([])\n      }}\n      onMouseOut={() => {\n        if (!rect) {\n          setSelected([])\n        }\n      }}\n    >\n      {options.type !== MarkSeries && !options.noLimit &&\n        options.data && options.data.length > limit &&\n        <h4>Plotting first {limit} values:</h4>}\n      {noYAxis && title &&\n        <h4>{title}</h4>\n      }\n      <FlexibleXYPlot xType=\"ordinal\"\n        margin={{ bottom: (plotStyle && plotStyle.marginBottom) || 40 }} // default is 40\n        animation={{ duration: 1 }}\n        height={(plotStyle && plotStyle.height) || W}\n        width={(plotStyle && plotStyle.width) || W}\n        onMouseLeave={() => { setHint(false) }}\n      >\n        {!noXAxis && // if provided dont\n          <XAxis\n            tickSize={0}\n            tickFormat={v => shortenName(v, 10)}\n            tickValues={\n              (data.length > limit)\n                ? data\n                  .filter((item, idx) => {\n                    if ((idx % Math.floor(data.length / limit)) === 0) {\n                      return item.x\n                    }\n                  }).map(item => (item.x))\n                : data.map(item => (item.x))\n            }\n            position=\"right\" tickLabelAngle={-65} style={{\n              line: { strokeWidth: 0 },\n              text: { fill: options.dark ? '#fff' : '#000' } //, fontWeight: plotStyle && plotStyle.fontWeight || 400 }\n            }} />}\n        {!noYAxis && // if provided dont\n          <YAxis\n            tickSize={0}\n            tickLabelAngle={-45} tickFormat={v => format(\".2s\")(v)} style={{\n              line: { strokeWidth: 0 },\n              title: { fill: options.dark ? '#fff' : '#000' },\n              text: { fill: options.dark ? '#fff' : '#000' } //, fontWeight: plotStyle && plotStyle.fontWeight || 400 }\n            }} position=\"start\" title={title} />\n        }\n        <ReactSeries\n          onValueClick={onValueClick}\n          // see abstract-series.js\n          /*\n          onNearestX(value, {\n            innerX: xScaleFn(value),\n            index: valueIndex,\n            event: event.nativeEvent\n          });\n          */\n          onNearestX={(datapoint, { index, innerX }) => {\n            setHint({ x: datapoint.x, y: datapoint.y });\n            if (rect && isWithinRect({ x, x1, value: innerX })) {\n              if (!selected.includes(index)) { // prevent rerender\n                setSelected([...selected, index]);\n              }\n              // TODO see how one can detect \"leaving\"\n              // outside the box but rect is dragging              // setSelected(selected.filter(e => e !== index));\n            } else {\n              if (!rect) {\n                setSelected([index]); // single hover\n              }\n            }\n          }}\n          colorDomain={[0, 1]}\n          colorRange={['rgb(239, 93, 40)', 'rgb(18, 147, 154)']}\n          // style={{ fill: type === LineSeries ? 'none' : 'rgb(18, 147, 154)' }}\n          data={dataWithColor} />\n        {hint && <Hint value={hint} />}\n      </FlexibleXYPlot>\n      {x && x1 && rect}\n    </div>);\n}\n\nfunction isWithinRect(options) {\n  const { x, x1, value } = options;\n  if (x1 > x) {\n    if (value > x && value < x1) {\n      return true\n    }\n    return false\n  } else {\n    if (value < x && value < x1) {\n      return true\n    }\n    return false\n  }\n}","import * as React from 'react';\nimport { FileUploader } from 'baseui/file-uploader';\n\nexport default class Uploader extends React.Component {\n  state = { progressAmount: 0 };\n\n  handleDrop = (acceptedFiles, rejectedFiles) => {\n    const { contentCallback } = this.props;\n    const textType = /text.*/;\n    const file = acceptedFiles[0]\n\n    if (!file.type || file.type.match(textType) || file.type.match(/geo/) \n    || file.type.match(/json/)) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        this.setState({ progressAmount: 100 });\n        this.reset();\n        const text = reader.result;\n        typeof (contentCallback) === 'function' &&\n          contentCallback({ text, name: file.name })\n      }\n      reader.readAsText(file);\n    } else {\n      this.setState({ progressAmount: 100 });\n      this.reset();\n      console.log(\"File not supported!\")\n    }\n    // handle file upload...\n    this.startProgress();\n  };\n\n  // startProgress method is only illustrative. Use the progress info returned\n  // from your upload endpoint. If unavailable, do not provide a progressAmount.\n  startProgress = () => {\n    this.intervalId = setInterval(() => {\n      if (this.state.progressAmount >= 100) {\n        this.reset();\n      } else {\n        this.setState({ progressAmount: this.state.progressAmount + 10 });\n      }\n    }, 500);\n  };\n\n  // reset the component to its original state. use this to cancel/retry the upload.\n  reset = () => {\n    clearInterval(this.intervalId);\n    this.setState({ progressAmount: 0 });\n  };\n\n  render() {\n    return (\n      <center className=\"file-upload\">\n        <FileUploader\n          onCancel={this.reset}\n          onDrop={this.handleDrop}\n          progressAmount={this.state.progressAmount}\n          progressMessage={\n            this.state.progressAmount &&\n            `Uploading... ${this.state.progressAmount}% of 100%`\n          }\n        />\n      </center>\n    );\n  }\n}","import React, { useState } from 'react';\nimport {\n  InputGroup, FormControl,\n  Glyphicon, FormGroup\n} from 'react-bootstrap';\n\nimport { isURL } from '../utils';\n\nexport default function URL(props) {\n  const { urlCallback } = props;\n  const [url, setUrl] = useState(\"https://domain.com/api/stats19\")\n\n  return (\n    <form\n      onKeyPress={(event) => {\n        if (event.which === 13 /* Enter */) {\n          event.preventDefault();\n          isURL(url) && typeof (urlCallback) === 'function' &&\n            urlCallback(url)\n        }\n      }}\n      className=\"search-form\">\n      <FormGroup>\n        <InputGroup>\n          <FormControl\n          onChange={(e) => {            \n            const { value } = e.target;\n            setUrl(value)\n            // console.log(isURL(value))\n          }}\n          style={{\n            background: props.dark ? '#242730' : 'white',\n            color: props.dark ? 'white' : 'black'\n          }}\n          value={url}\n          placeholder={url} type=\"text\" />\n          <InputGroup.Addon\n          style={{\n            background: props.dark ? '#242730' : 'white',\n            color: props.dark ? 'white' : 'black'\n          }}>\n            <Glyphicon \n            glyph=\"globe\" />\n          </InputGroup.Addon>\n        </InputGroup>\n      </FormGroup>\n    </form>\n  )\n}","function define(name, value) {\n  Object.defineProperty(exports, name, {\n    value: value,\n    enumerable: true\n  });\n}\n\n// TODO: change to domain name \ndefine(\"PRD_URL\", 'https://layik.github.io/eAtlas')\ndefine(\"DEV_URL\", 'http://localhost:8000')\n\ndefine(\"UI_LIST\", [\n  \"checkbox\",\n  \"radio\",\n  \"buttongroups\",\n  \"dropdown\",\n  \"slider\"])\n  \ndefine(\"DECKGL_INIT\", {\n  longitude: -1.6362,\n  latitude: 53.8321,\n  zoom: 10,\n  pitch: 55,\n  bearing: 0,\n})\n\ndefine(\"LIGHT_SETTINGS\", {\n  lightsPosition: [-0.144528, 49.739968, 8000, -3.807751, 54.104682, 8000],\n  ambientRatio: 0.4,\n  diffuseRatio: 0.6,\n  specularRatio: 0.2,\n  lightsStrength: [0.8, 0.0, 0.8, 0.0],\n  numberOfLights: 2\n})\n\ndefine(\"PLOT_W\", 250)\n\ndefine(\"TURQUOISE_RANGE\", ['#12939A','#1293FF'])\n\ndefine(\"BLANKSTYLE\", {\n  \"version\": 8, \"name\": \"Blank\", \"center\": [0, 0],\n  \"zoom\": 0, \"sources\": {},\n  \"layers\": [{\n    \"id\": \"background\", \"type\": \"background\", \"paint\":\n      { \"background-color\": \"rgba(255,255,255,1)\" }\n  }], \"id\": \"blank\"\n})\n\ndefine(\"ICONLIMIT\", 500)\ndefine(\"ELEVATION\", 4)\ndefine(\"RADIUS\", 100)\n\ndefine(\"DATE_REGEX\", \"date|time|datetime|year\")","/**\n * eAtlas code\n *  \n * React component which takes a GeoJSON object. Loops through its\n * properties and show the list to start with. Each property \n * can show all avialable values. Each value can be selected/deselected.\n *\n * Current code can deal with only one GeoJSON property's keys.\n * \n * Next is handling multiple GeoJSON key value pairs.\n * Next will be replacing current \"hard\" code in the parent code,\n * so that all key values can be dynamically filtered.\n * \n * This should be generalizeable to any GeoJSON file, or that is the\n * aim.\n */\nimport React, { useState } from 'react';\n\nimport './style.css';\nimport { humanize } from '../utils';\nimport { isEmptyOrSpaces } from '../JSUtils';\nimport { describeFeatureVariables } from '../geojsonutils';\nimport { Select, TYPE } from 'baseui/select';\nimport MultiSelect from './MultiSelect';\n\nexport default function Variables(props) {\n  const { onSelectCallback, multiVarSelect,\n    unfilteredData } = props;\n  const [columns, setColumns] = useState(multiVarSelect && \n    Object.keys(multiVarSelect))\n\n  if (!unfilteredData || !unfilteredData[0]) return null;\n\n  if (unfilteredData && Object.keys(unfilteredData[0].properties)\n    .filter(p => !isEmptyOrSpaces(p)).length === 0) {\n    return (\n      <h3>There are no columns to inspect or filter.</h3>\n    )\n  }\n  // describe first feature\n  const description = describeFeatureVariables(unfilteredData[0]);\n  const dataCols = Object.keys(unfilteredData[0].properties)\n    .map(e => ({\n      // Format: Column Name [String]\n      id: humanize(e) + \" [\" + description[e].name + \"]\",\n      value: e\n    }))\n\n  // unique set of keys\n  let syncColumns = Array.from(new Set(columns.map(e => e.value).concat(\n    Object.keys(multiVarSelect)\n  )));\n  // populate baseweb objects using description\n  syncColumns = syncColumns.map(e => ({\n    // Format: Column Name [String]\n    id: humanize(e) + \" [\" + description[e].name + \"]\",\n    value: e\n  }))\n  // console.log(columns);\n  // console.log(syncColumns);\n  // use synced column names\n  return (\n    <div style={props.style}>\n      Column to filter:\n      <Select\n        labelKey=\"id\"\n        valueKey=\"value\"\n        placeholder={\"Chose column \" + \"(\" + dataCols.length + \")\"}\n        maxDropdownHeight=\"300px\"\n        type={TYPE.search}\n        multi={true}\n        onChange={({ value }) => {\n          // sync with multiVarSelect \n          // here we remove any key in multiVarSelect that is not \n          // in the values here\n          const columnsArray = value.map(e => e.value)\n          Object.keys(multiVarSelect).map(key => {\n            //delete any that is not in value\n            if (!columnsArray.includes(key)) {\n              if (multiVarSelect[key].size) {\n                // first delete the item\n                delete multiVarSelect[key]\n                // then only if there is a value assigned\n                typeof (onSelectCallback) === 'function' &&\n                  onSelectCallback(multiVarSelect)\n              } else {\n                // just remove the column from state\n                delete multiVarSelect[key]\n              }\n            }\n          })\n          setColumns(value)\n        }}\n        value={syncColumns}\n        options={dataCols}\n      />\n      {\n        syncColumns && syncColumns.map(e => e.value)\n          .map(key => {\n            const columnValues = [];\n            unfilteredData.forEach(feature =>\n              Object.keys(feature.properties).forEach(property =>\n                property === key && feature.properties[key] &&\n                !columnValues.includes(feature.properties[key]) &&\n                columnValues.push(\n                  feature.properties[key]\n                )\n              )\n            )\n            return <>\n              {humanize(key)}\n              <MultiSelect\n                title={\"Available (\" + columnValues.length + \")\"}\n                filter={key}\n                multiVarSelect={multiVarSelect}\n                // all string from here\n                values={columnValues.map(e => ({ id: e + \"\", value: e + \"\" }))}\n                onSelectCallback={(filter) => {\n                  typeof (onSelectCallback) === 'function' &&\n                    onSelectCallback(filter.selected || {});\n                }}\n                value={multiVarSelect[key] &&\n                  Array.from(multiVarSelect[key])\n                    .map(e => ({ id: e + \"\", value: e + \"\" }))\n                }\n              />\n            </>\n          })\n      }\n    </div>\n  )\n}","import React from 'react';\nimport { Table } from 'baseui/table';\nimport { Pagination } from 'baseui/pagination';\n\nimport { humanize } from '../utils';\n\nexport default function DataTable(props) {\n  const [currentPage, setCurrentPage] = React.useState(1);\n\n  const { data } = props;\n  if (!data || data.length === 0) return null\n  const numPages = Math.floor(data.length / 10)\n\n  const columns = Object.keys(data[0].properties)\n    .map(each => humanize(each))\n\n  const rows = data.slice(currentPage * 10, (currentPage * 10) + 10)\n    .map(feature => Object.keys(feature.properties).map(e =>\n      feature.properties[e]))\n\n  return (\n    <>\n      <Pagination\n        numPages={numPages}\n        currentPage={currentPage}\n        onPageChange={({ nextPage }) => {\n          setCurrentPage(Math.min(Math.max(nextPage, 1), numPages));\n        }}\n      />\n      <Table columns={columns} data={rows} />\n      {/* // not nice 1000px */}\n      <Pagination\n        numPages={numPages}\n        currentPage={currentPage}\n        onPageChange={({ nextPage }) => {\n          setCurrentPage(Math.min(Math.max(nextPage, 1), numPages));\n        }}\n      />\n    </>\n  )\n}","import React from 'react';\n\nimport { Slider } from 'baseui/slider';\nimport { Checkbox } from 'baseui/checkbox';\nimport { Button } from 'baseui/button';\nimport { StatefulButtonGroup } from 'baseui/button-group';\nimport { StatefulSelect, TYPE } from 'baseui/select';\n\nimport {\n  suggestUIforNumber, humanize\n} from '../utils';\n\nexport default class UI extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      checks: [],\n    }\n  }\n\n  render() {\n    const {\n      title, sublist, suggested, onChange, steps\n    } = this.props;\n    if (!title || !sublist || sublist.length === 0) return null;\n    const new_checks = this.state.checks;\n    const ui_name = suggested || suggestUIforNumber(sublist.length)\n    let ui_returned = null;\n    if (ui_name === \"checkbox\") {\n      ui_returned = <>\n        {\n          sublist.map((each, i) =>\n            // deal with each checked!\n            <Checkbox\n              key={each}\n              checked={this.state.checks[i]}\n              value={each}\n              onChange={() => {\n                new_checks[i] = !new_checks[i]\n                this.setState({\n                  checks: new_checks\n                })\n              }}>\n              {each}\n            </Checkbox>\n          )\n        }\n      </>\n    } else if (ui_name === \"slider\" && parseInt(sublist[0])) {\n      const s = sublist;\n      ui_returned =\n        <>\n          <Slider\n            value={this.state.value || [s[0]]}\n            min={parseInt(s[0])}\n            max={parseInt(s[s.length - 1])}\n            step={steps || 1} //something\n            onChange={({ value }) => {\n              this.setState({ value });\n              typeof (onChange) === 'function' && onChange(value[0])\n            }}\n          />\n          {title}\n        </>\n    } else if (ui_name === \"buttongroups\") {\n      ui_returned = <>\n        Checkbox Mode StatefulButtonGroup\n        <StatefulButtonGroup mode=\"checkbox\"\n          initialState={{ selected: [0] }}\n        >\n          {\n            sublist.map((each, i) =>\n              <Button\n                key={each + \"-\" + i}\n                value={each}\n                onClick={(e) => console.log(e.target.value)}>\n                {each}\n              </Button>\n            )\n          }\n        </StatefulButtonGroup>\n      </>\n    } else {\n      ui_returned = <StatefulSelect\n        options={sublist.map(each => ({ id: each }))}\n        labelKey=\"id\"\n        placeholder={\"Choose \" + humanize(title)}\n        type={TYPE.search}\n        onChange={event => \n          console.log(event && event.value[0] && event.value[0].id)\n        }\n      />\n    }\n    return ui_returned\n  }\n}","import {\n  isNumber, isBoolean, isObject, isString\n} from './JSUtils';\n\nconst { DateTime } = require(\"luxon\");\n\n// thanks turfjs\n//http://wiki.geojson.org/GeoJSON_draft_version_6\nconst sfType = (geojson) => {\n  if (geojson.type === \"FeatureCollection\") { return \"FeatureCollection\"; }\n  if (geojson.type === \"GeometryCollection\") { return \"GeometryCollection\"; }\n  if (geojson.type === \"Feature\" && geojson.geometry !== null) {\n    return geojson.geometry.type;\n  }\n  return geojson.type;\n}\n\nconst properties = (geojson) => {\n  if (!geojson || !geojson.features) return null;\n  var properties = geojson.features[0].properties;\n  return Object.keys(properties);\n}\n\n/**\n * Find all columns which can be considered as key/unique columns.\n * Using `getPropertyValues` we compare the length with\n * geojson objects and determin which olumn can be considered as key.\n * \n * @param {Object} geojson to process\n * @returns array of keys or null if none.\n */\nconst getKeyColumns = (geojson) => {\n  if (!geojson || !geojson.features) return null;\n  const keys = [];\n  const all_property_counts = getPropertyValues(geojson);\n  Object.keys(all_property_counts).forEach(column => {\n    if (Array.from(all_property_counts[column]).length ===\n      geojson.features.length) {\n      keys.push(column);\n      // if property values of column === geojson.features\n      // must be unique      \n    }\n  })\n  return keys.length > 0 ? keys : null;\n}\n\n/**\n * Given an array of [E010000001, S010000001] the function checks\n * all values within the array and returns true if all matches\n * pattern for UK ONS codes.\n * See https://en.wikipedia.org/wiki/ONS_coding_system\n * \n * @param {*} array \n */\nconst isONSCode = (array) => {\n  if (!array || array.length === 0) return false;\n  let result = true;\n  array.forEach(e => {\n    if (!isString(e) || e.length !== 9 || !e.match(/^[EWS]\\d{2}.{6}$/)) {\n      result = false;\n    }\n  })\n  return result;\n}\n/**\n * {some: data, another: value}\n * turn it into {some: type, another: type}\n * @param {Object} feature \n */\nconst describeFeatureVariables = (feature) => {\n  if (!feature || feature.type !== 'Feature') return null;\n  const description = {};\n\n  Object.keys(feature.properties).forEach(key => {\n    let v_type = String;\n    const value = feature.properties[key];\n\n    if (isStringDate(value)) {\n      v_type = Date\n    } else if (isNumber(value)) {\n      v_type = Number\n    } else if (isBoolean(value)) {\n      v_type = Boolean\n    } else if (isObject(value)) {\n      v_type = Object\n    }\n    description[key] = v_type;\n  })\n  return (description)\n}\n\n/**\n * This function takes a geojson object and optionally a property\n * it returns a set (in array) object of all values for that property.\n * \n * If no property is given it gets all properties\n * of each feature and adds unique values for each in a Set.\n * \n * @param {Object} geojson \n * @param {String} property \n */\nconst getPropertyValues = (geojson, property) => {\n  if (!geojson || !geojson.features) return null;\n  const all = {}\n  let values = new Set();\n  geojson.features.forEach(feature => {\n    feature.properties && Object.keys(feature.properties) &&\n    Object.keys(feature.properties).forEach((each) => {\n      if (property && property === each) {\n        // if the right property, \n        // add it to the value to be returnd\n        values.add(feature.properties[each])\n      } else {\n        if (typeof (all[each]) === 'object') { // a set\n          all[each].add(feature.properties[each])\n        } else {\n          all[each] = new Set();\n          all[each].add(feature.properties[each])\n        }\n      }\n    })\n  })\n  return property ? Array.from(values) : all;\n}\n\n/**\n * Get a list of {x:property, y:count} objects for a features in \n * a geojson object. The function can return the counts for\n * a specific list provided or it would get all values in \n * the given key/column of the data.\n * \n * @param {Object} data features to loop through. \n * @param {String} key a particular property as key\n * @param {Object} list of values to limit return their counts\n * \n * @returns {Object}\n */\nconst propertyCount = (data, key, list) => {\n  if (!data || !key) return;\n  let sub_data = []; // match it with list\n  let list_copy = list;\n  if (!list || list.length === 0) {\n    list_copy = getPropertyValues({\n      features: data\n    }, key)\n  }\n  data.forEach(feature => {\n    Object.keys(feature.properties).forEach(each => {\n      if (each === key) {\n        // create an array matching given list\n        // if no list match first \n        const i = list_copy.indexOf(feature.properties[each]);\n        if (sub_data[i] &&\n          sub_data[i].x === feature.properties[each]) {\n          sub_data[i].y += 1;\n        }\n        else {\n          sub_data[i] = { x: feature.properties[each], y: 1 };\n        }\n      }\n    });\n  });\n  return sub_data;\n}\n\n/**\n * Generate an object with frequency of values of a particular property, arranged\n * under a different property. Given features = \n * [{p1: a, p2: b, p3: v1},\n * {p1: a, p2: b, p3: v1},\n * {p1: b, p2: a, p3: v2},\n * ].\n * The function returns an object {v1: {a: 2, b: 2}, v2: {a:1, b:1}}\n * \n * @param {Object} data features to loop through. \n * @param {String} key a particular property as key\n * @param {String} key2 a different property as key\n * @param {Boolean} year extract year out of Date string?\n * \n * @returns {Object} \n */\nconst propertyCountByProperty = (data, key, key2, year = true) => {\n  if (!data || !key || !key2 || key === key2) return;\n  let sub_data = {} // create object based on key2 values\n  data.forEach(feature => {\n    const props = feature.properties;\n    if(!props || !Object.keys(props)) return\n    /**\n     * TODO: \n     */\n    const k2 = year && new Date(props[key2]) &&\n    new Date(props[key2]).getFullYear() ? \n    new Date(props[key2]).getFullYear() : props[key2];\n    Object.keys(props).forEach(each => {\n      if (each === key) {\n        // create object based on key2 values\n        if (sub_data[k2] && sub_data[k2][props[each]]) {\n          sub_data[k2][props[each]] += 1;\n        }\n        else {\n          sub_data[k2] = Object.assign(\n            sub_data[k2] || {}, { [props[each]]: 1 }\n          );\n        }\n      }\n    });\n  });\n  return sub_data;\n}\n\nconst coordsAsXY = (geojson, sizeProperty) => {\n  if (!geojson.features) return null;\n  return (\n    geojson.features.map(each => {\n      // lon lat please\n      const result = {\n        x: each.geometry.coordinates[0],\n        y: each.geometry.coordinates[1]\n      }\n      if (sizeProperty && each.properties[sizeProperty]) {\n        result.size = each.properties[sizeProperty]\n      }\n      return (result)\n    })\n  )\n}\n\nexport {\n  describeFeatureVariables,\n  propertyCountByProperty,\n  getPropertyValues,\n  getKeyColumns,\n  propertyCount,\n  isStringDate,\n  properties,\n  coordsAsXY,\n  isONSCode,\n  sfType\n}\n\nfunction isStringDate(value) {\n  return DateTime.fromFormat(value + '', 'MMMM dd yyyy').isValid ||\n    DateTime.fromFormat(value + '', 'MMMM d yyyy').isValid ||\n    DateTime.fromFormat(value + '', 'MMM d yyyy').isValid ||\n    DateTime.fromFormat(value + '', 'MMM dd yyyy').isValid ||\n    DateTime.fromFormat(value + '', 'dd/MM/yyyy').isValid ||\n    DateTime.fromFormat(value + '', 'dd-MM-yyyy').isValid ||\n    DateTime.fromFormat(value + '', 'yyyy/mm/dd').isValid ||\n    DateTime.fromFormat(value + '', 'yyyy-mm-dd').isValid ||\n    DateTime.fromISO(value).isValid || // \"19-2-1999\"\n    DateTime.fromHTTP(value).isValid ||\n    (typeof value === Number && DateTime.fromMillis(value).isValid);\n}\n","import React, { useState } from 'react';\nimport { makeWidthFlexible, Treemap } from 'react-vis';\n\nimport { PLOT_W } from '../Constants';\n\nconst FlexibleTreemap = makeWidthFlexible(Treemap); \n\nconst H = PLOT_W;\n/**\n * props.data needs to be in this formard\n * {\n *    title: 'sometitle',\n *    color: 1,\n *    children: [1,2,3,4].map(e => ({\n *      name: e,\n *      size: Math.random() * 500,\n *      color: Math.random(),\n *      style: {\n *        border: 'thin solid red'\n *      }\n *     }\n *   ))\n * }\n * \n * @param {Object} props react props\n */\nexport default function TreeMap(props) {\n  const [hoveredNode, setHoveredNode] = useState(false)\n  const { data, plotStyle, title } = props;\n  \n  const treeProps = {\n    animation: {\n      damping: 9,\n      stiffness: 300\n    },\n    data,\n    onLeafMouseOver: x => setHoveredNode({ hoveredNode: x }),\n    onLeafMouseOut: () => setHoveredNode({ hoveredNode: false }),\n    // onLeafClick: () => this.setState({ treemapData: _getRandomData() }),\n    mode: 'squarify',\n    getLabel: x => x.name,\n    // see \n    // https://github.com/uber/react-vis/issues/262#issuecomment-281757385\n    width: plotStyle && plotStyle.width || H + 50,\n    height: plotStyle && plotStyle.height || H\n  };\n\n  if(!data || data.length === 0) return null;\n  return (\n    <div className=\"dynamic-treemap-example\">\n      <h6>{title}</h6>\n      {<FlexibleTreemap {...treeProps} />}\n        {hoveredNode && hoveredNode.value}\n    </div>\n  )\n}","import React, { useState, useEffect } from 'react';\nimport { Button, KIND, SIZE } from 'baseui/button';\nimport { Accordion, Panel } from 'baseui/accordion';\nimport { VerticalBarSeries, HorizontalBarSeries, LineSeries } from 'react-vis';\n\nimport MultiSelect from './MultiSelect';\nimport TreeMap from './TreeMap';\nimport { humanize } from '../utils';\nimport { isString, isNumber } from '../JSUtils';\nimport { xyObjectByProperty } from '../utils';\nimport SeriesPlot from './showcases/SeriesPlot';\n\nconst VIS = ['Vertical Bar', 'Horizontal Bar',\n  'Line', 'Pop. Pyramid', 'Treemap'];\n\n/**\n * Generate approprate series/marks for a React-vis\n * type from data and column name.\n * \n * @param {Object} data geojson features to generate counts from\n * @param {String} column name of column in feature to generate counts from\n * @param {String} vis type of visualization (react-vis type)\n * @param {Object} plotStyle styling of the plot (css)\n * @param {Boolean} noLimit boolean to crop chart\n * @param {Boolean} dark boolean to switch theme\n */\nfunction generateVIS(data, column, vis, plotStyle, noLimit, dark) {\n  if (!data || data.length === 0 || !isString(column) || !isString(vis)) {\n    return;\n  }\n  let counts = xyObjectByProperty(data, column)\n\n  if (vis === 'Treemap') {\n    return (\n      <TreeMap\n        plotStyle={plotStyle}\n        data={{\n          title: column + \" \" + vis,\n          color: 1,\n          children: counts.map((e, i) => ({\n            name: e.x,\n            size: +(e.y) / data.length,\n            color: isNumber(e.x) || i,\n            style: {\n              border: 'thin solid red'\n            }\n          }))\n        }}\n        title={humanize(column)}\n      />\n    )\n  }\n  if (vis.startsWith('Vertical') ||\n    vis.startsWith(\"Horizontal\") ||\n    vis.startsWith(\"Line\")) {\n    return (\n      <SeriesPlot\n        dark={dark}\n        noLimit={noLimit}\n        plotStyle={plotStyle}\n        data={counts}\n        type={\n          vis.startsWith(\"Vertical\") ?\n            VerticalBarSeries :\n            vis.startsWith(\"Horizontal\") ?\n              HorizontalBarSeries :\n              LineSeries\n        }\n        title={humanize(column)} noYAxis={true}\n      />\n    )\n  }\n}\nexport default function AddVIS(props) {\n  const [column, setColumn] = useState(false)\n  const [vis, setVis] = useState(false)\n  const [list, setList] = useState([]);\n  // useEffect(() => {\n  // if props.data changes only then it should react to it\n  // setVis(false);\n  // setColumn([])\n  // }, [props.data])\n\n  const { data, onSelectCallback, dark,\n    noAccordion, plotStyle, noLimit } = props;\n\n  if (!data || data.length === 0) return null;\n\n  const columns = Object.keys(data[0].properties);\n\n  return (\n    <div>\n      <h6>Generate graphs from columns</h6>\n      <div className=\"searchField\">\n        <MultiSelect\n          single={true}\n          title=\"Choose column\"\n          values={columns.map(e => ({ id: humanize(e), value: e }))}\n          onSelectCallback={(selected) => {\n            setColumn(selected);\n            typeof onSelectCallback === 'function' &&\n              onSelectCallback(selected)\n          }}\n          // sync state\n          value={column}\n        />\n        {column.length > 0 &&\n          <MultiSelect\n            single={true}\n            title=\"Choose vis\"\n            values={VIS.map(e => ({ id: e, value: e }))}\n            onSelectCallback={(selected) => {\n              setVis(selected)\n            }}\n            // sync state\n            value={vis}\n          />}\n      </div>\n      <Button\n        kind={KIND.secondary} size={SIZE.compact}\n        onClick={() => {\n          if (column.length === 0 || vis.length === 0 || !column[0]) return;\n          setList([\n            ...list,\n            generateVIS(data, column[0].value, vis[0].value, plotStyle, dark, noLimit)\n          ])\n        }}>Add</Button>\n      <div className=\"visArea\">\n        {!noAccordion ?\n          <Accordion\n            overrides={{\n              Root: { style: { width: \"270px\" } }\n            }}\n            expanded={true}\n            onChange={({ expanded }) => console.log(expanded)}\n          >\n            {\n              list.map((plot, i) =>\n                <Panel key={'panel-' + i}>\n                  <Button\n                    kind={KIND.secondary} size={SIZE.compact}\n                    onClick={() => {\n                      setList(\n                        list.filter((e, j) => i !== j)\n                      )\n                    }}>X</Button>\n                  {plot}\n                </Panel>\n              )\n            }\n          </Accordion> :\n          <center>\n            {list.map((plot, i) =>\n              plot && \n              <div>\n                <Button\n                  kind={KIND.secondary} size={SIZE.compact}\n                  onClick={() => {\n                    setList(\n                      list.filter((e, j) => i !== j)\n                    )\n                  }}>X</Button>\n                {plot}\n              </div>)\n            }\n          </center>\n        }\n      </div>\n    </div >\n  )\n}"],"sourceRoot":""}